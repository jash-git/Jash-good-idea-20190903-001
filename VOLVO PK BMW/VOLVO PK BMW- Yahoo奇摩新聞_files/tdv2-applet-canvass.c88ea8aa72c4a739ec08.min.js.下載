webpackJsonp([19],{1361:function(e,t,n){"use strict";e.exports={controllerViews:{CanvassApplet:n(3293)},stores:{CanvassCommentFormStore:n(2315),CanvassConfigStore:n(117),CanvassLinkEnhancerStore:n(2773),CanvassSentimentsStore:n(2765),CanvassStore:n(307),CanvassTumblrStore:n(2542)},meta:{dependencies:["tdv2-service-profile"]}}},1471:function(e,t,n){"use strict";function a(e){var t=n(21).ReactI13n.getInstance();t&&t.execute("pageview",{pageParams:{pd:"canvass-"+e,navtype:"client"}})}function s(e,t){var a={sec:"cmmts",subsec:"canvass",outcm:"show"};t&&(a=Object.assign(a,t));var s=n(21).ReactI13n.getInstance();s&&s.execute("beacon",{beaconType:"beaconEvent",arguments:[e,a,a.outcm]})}function o(e){var t={sec:"cmmts",_p:"0",subsec:"canvass",outcm:"clicked"};e&&(t=Object.assign(t,e));var a=n(21).ReactI13n.getInstance();a&&a.execute("beacon",{beaconType:"beaconClick",arguments:[t.sec,t.slk||"-",t._p,t,t.outcm]})}function r(e,t){if(!i[e])throw new Error('There is no I13nModel for "'+e+'"');return t?Object.assign({},i[e],t):i[e]}Object.defineProperty(t,"__esModule",{value:!0}),t.I13nButton=t.I13nAnchor=void 0,t.fireRapidPageView=a,t.fireRapidEvent=s,t.fireRapidClick=o,t.getI13nModel=r;var i=(t.I13nAnchor=(0,n(21).createI13nNode)("a",{bindClickEvent:!0,follow:!0,isLeafNode:!1}),t.I13nButton=(0,n(21).createI13nNode)("button",{bindClickEvent:!0,isLeafNode:!1}),{login:{slk:"login",elm:"cmmt_login",itc:0,outcm:"login"},"comments-open":{slk:"show",elm:"cmmt_open",outcm:"open"},"comments-close":{slk:"hide",elm:"cmmt_open",outcm:"close"},"comments-showMore":{slk:"load more",elm:"cmmt_more",outcm:"more"},"comments-showNew":{slk:"load new",elm:"cmmt_new",outcm:"more"},"comment-delete":{slk:"delete",elm:"cmmt_delete",itc:1,outcm:"delete"},"comment-report-cancel":{slk:"close",elm:"cmmt_abuse",outcm:"close"},"comment-flag":{slk:"abuse",elm:"cmmt_abuse",itc:1,outcm:"open"},"comment-block":{slk:"mute",elm:"cmmt_mute",outcm:"close"},"comment-report-done":{elm:"cmmt_abuse",outcm:"close",itc:1},"comment-post":{slk:"post",elm:"cmmt_post",outcm:"post"},"comment-seemore":{slk:"read more",elm:"cmmt_read",outcm:"read"},guidelines:{slk:"guideline show",elm:"cmmt_guideline"},options:{elm:"cmmt_options",slk:"options",outcm:"options"},"replies-show":{slk:"open replies",elm:"cmmt_more",elmt:"showreply",outcm:"show"},reply:{slk:"open reply",elm:"cmmt_reply",outcm:"focus"},"reply-post":{slk:"post reply",elm:"cmmt_reply",outcm:"post"},react:{slk:"open reactions",elm:"cmmt_react"},vote:{elm:"cmmt_vote",outcm:"rate"},link:{slk:"smartlink",elm:"cmmt_link",itc:0,outcm:"navigate"},"context-link":{elm:"cmmt_ctx",itc:0},"tumblr-icon":{slk:"gif-show",elm:"cmmt_gif",outcm:"show"},"tumblr-post":{elm:"cmmt_gif",outcm:"post"},"link-prvw-close":{slk:"link-prvw-close",elm:"cmmt_link",outcm:"close"},"text-input":{slk:"text-input",elm:"cmmt_text",outcm:"focus"},sort:{elm:"cmmt_sort",outcm:"sort"},"sort-btn":{elm:"cmmt_sort_btn"},"user-avatar-tap":{slk:"open user messages",elm:"cmmt_avatar",outcm:"history"},"user-comments-tap":{slk:"open user messages",elm:"cmmt_history",outcm:"history"},"user-name-tap":{slk:"open user messages",elm:"cmmt_username",outcm:"history"},"user-close-tap":{slk:"close user messages",elm:"cmmt_username",outcm:"history"},"related-tags":{elm:"cmmt_trending_tag"},"sentiments-tap":{slk:"sentiments",elm:"cmmt_sentiments",outcm:"show"},"sentiments-close-tap":{slk:"sentiments close",elm:"cmmt_sentiments",outcm:"hide"},userlabels:{slk:"userlabels show",elm:"cmmt_userlabels"},"userlabels-tap":{elm:"cmmt_userlabels"}})},1597:function(e,t,n){"use strict";function a(e,t){return t.forEach(function(t){e[t]=e[t].bind(e)}),e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=a,e.exports=t.default},1876:function(e,t){if(void 0===n)var n={};n.CoreArrowUp={name:"CoreArrowUp",height:49,width:49,path:"M2.053 36.584l2.18 2.18c1.353 1.364 3.76 1.364 5.11 0L25.014 23.09l15.68 15.68c1.408 1.394 3.69 1.394 5.102-.01l2.177-2.18c1.367-1.354 1.367-3.76.003-5.104L27.562 11.053c-1.407-1.39-3.688-1.395-5.102.01L2.043 31.486c-1.39 1.404-1.395 3.684.01 5.1z"},void 0!==e&&e.exports&&(e.exports=n.CoreArrowUp)},1886:function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function s(e,t,n){d("expand",t);var a=t&&(t.id||t.instanceId);if(!a)return n&&n(new Error("expandMessages requires an instanceId"));var s=e.session.query,i=e.getStore(r.default).getState(),f=e.getStore(o.default),p=f.getCommentsState(a),m=p.get("messageList")||u.default.List(),h={id:a,instanceId:a,isExpanded:(0,l.default)(t,["expanded"],!0)};if(!h.isExpanded||m.size>0||h.isExpanded===p.get("expanded"))e.dispatch("COMMENTS_EXPAND",h),n&&n();else{var g={context:t.uuid||t.context||s.context||"YahooGlobal",contextDisplayText:t.contextDisplayText||p.get("contextDisplayText"),contextUrl:t.contextUrl||p.get("contextUrl"),expanded:!0,index:t.nextIndex||null,instanceId:a,lang:i.lang,messagesPerPage:i.messagesPerPage,namespace:t.namespace||p.get("namespace")||i.namespace,region:i.region,selectedTags:t.selectedTags,sortBy:t.sortBy||p.get("sortBy"),tagsAnd:t.tagsAnd,tagsOr:t.tagsOr,oauthConsumerKey:i.oauthConsumerKey,oauthConsumerSecret:i.oauthConsumerSecret};e.executeAction(c.default,g,function(t,s){f.getCommentsState(a).get("error")||e.dispatch("COMMENTS_EXPAND",h),n&&n()})}}Object.defineProperty(t,"__esModule",{value:!0});var o=a(n(307)),r=a(n(117)),i=a(n(3)),l=a(n(2)),u=a(n(11)),c=a(n(534)),d=(0,i.default)("Canvass:actions:expandMessages");s.displayName="expandMessages",t.default=s,e.exports=t.default},1957:function(e,t,n){"use strict";function a(e){this._styles={},e&&this.set(e)}function s(e){var t,n="";for(t in e)e.hasOwnProperty(t)&&e[t]&&(n+=" "+t);return n}function o(e){return e?(Array.isArray(e)&&(e=e.join(" ")),"object"==typeof e&&(e=s(e)),e.trim().split(p)):[]}function r(e,t){return e[t.replace(m,"")]=t,e}function i(e){return o(e).reduce(r,{})}function l(e){return Object.keys(e).map(function(t){return e[t]}).join(" ")}function u(e){if(Array.isArray(e))return e.forEach(u,this);Object.keys(e).forEach(function(t){this._styles[t]=h(this._styles[t]||{},i(e[t]))},this)}function c(e,t){var n={};return o(e).forEach(function(e){h(n,this._styles[e])},this),t&&h(n,i(t)),l(n)}function d(e,t){return h(e,i(t))}function f(){return l([].reduce.call(arguments,d,{}))}var p=/\s+/g,m=/\(.+\)/,h=n(45);a.prototype={set:u,get:c,dedupe:f},e.exports=a},2043:function(e,t,n){"use strict";e.exports=new(n(1957))},2218:function(e,t,n){"use strict";function a(e){var t=e.session.protocol+"://"+e.session.host;try{var n=e.getStore("RouteStore"),a=n.getCurrentNavigate()||{},s=a.url;return s?t+s:location.href}catch(e){return t}}function s(e,t,n,s){var o="https://login.yahoo.com/";if(!e||!e.session)return o+"?.intl=US&.lang=en-US&.done="+encodeURIComponent("https://www.yahoo.com");var r=e.session.dimensions||{},i=e.session.query||{},l=(e.contextUrl||i.contextUrl||a(e))+"?bcmt=1";return t&&(l+="&messageId="+encodeURIComponent(t)),n&&(l+="&replyId="+encodeURIComponent(n)),o+"?.intl="+r.intl+"&.lang="+r.lang+"&.done="+encodeURIComponent(l)+(s?"&.src="+encodeURIComponent(s):"")}Object.defineProperty(t,"__esModule",{value:!0}),t.getRoute=a,t.getLoginUrl=s},2314:function(e,t,n){n(2043).set({btn:"Ff(ss) Fz(14px) Fw(b) Bdw(0) Ta(c) Cur(p) Va(m) Bdrs(4px) O(n)! Lh(n)","btn-primary":"Bgc($c-fuji-blue-1-a) Bgc($c-fuji-blue-3-a):h C(#fff) Bd(n)","btn-secondary":"Bgc(#fff) C($c-fuji-blue-1-a) Bdw(2px) Bdc($c-fuji-blue-1-a) Bd C(#fff):h Bgc($c-fuji-blue-1-a):h","btn-spacing":"Mt(20px) Mb(20px) Px(30px) Py(10px)","btn-fullwidth-sm":"W(100%)--xs Bdrs(2px)--xs Bdw(1px)--xs Fw(600)--xs Py(12px)--xs"}),e.exports=n(2043)},2315:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=(0,function(e){return e&&e.__esModule?e:{default:e}}(n(18)).default)({storeName:"CanvassCommentFormStore",statics:{handlers:{CANVASS_HEARTBEAT_SUCCESS:"heartbeatSuccess",CANVASS_POST_FAILURE:"canvassFailure",CANVASS_POST_SUCCESS:"canvassSuccess"}},initialize:function(){this.state={activeForm:null,commenting:{},errorMessage:""}},canvassFailure:function(e){this.setCommentingState(e.replyId?e.messageId:e.contextId,!1),this.state.errorMessage="CANVASS_NETWORK_ERROR",this.state.messageId=e.messageId,this.state.replyId=null,this.emitChange()},canvassSuccess:function(e){this.setCommentingState(e.replyId?e.messageId:e.contextId,!1),this.state=Object.assign(this.state,e,{errorMessage:"",replyId:e.replyId||null}),this.emitChange()},isActiveForm:function(e){var t=this.state.activeForm;return!!t&&t.messageId===e.messageId&&t.replyId===e.replyId},getActiveForm:function(){return this.state.activeForm||{}},setActiveForm:function(e){this.isActiveForm(e)||(this.state.activeForm={messageId:e.messageId,replyId:e.replyId},this.emitChange())},setFormInactive:function(e){this.isActiveForm(e)&&(this.state.activeForm=e.replyId?{messageId:e.messageId}:null,this.emitChange())},setCommentingState:function(e,t){var n=this.state.commenting[e]||!1;e&&n!==t&&(this.state.commenting=Object.assign({},this.state.commenting),this.state.commenting[e]=t,this.emitChange())},heartbeatSuccess:function(e){var t=e.eventType,n=e.messageId||e.context;"START_TYPING"===t&&n?this.setCommentingState(n,!0):"STOP_TYPING"===t&&n&&this.setCommentingState(n,!1)},getState:function(){return this.state},dehydrate:function(){return this.state},rehydrate:function(e){this.state=e}}),e.exports=t.default},2316:function(e,t,n){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),i=(function(e){}(n(0)),function(e){function t(e){a(this,t);var n=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={shouldRender:!1},n}return o(t,e),r(t,[{key:"componentDidMount",value:function(){this.setState({shouldRender:!0})}},{key:"render",value:function(){return this.state.shouldRender?this.props.children:null}}]),t}(n(1).Component));t.default=i,e.exports=t.default},2317:function(e,t,n){"use strict";function a(e,t,n){if(!parent)return n&&n();parent===window?window.location.href=t.loginUrl:parent.postMessage(JSON.stringify({context:t.context,isCanvass:!0,loginUrl:t.loginUrl}),"*"),n&&n()}Object.defineProperty(t,"__esModule",{value:!0}),a.displayName="loginUser",t.default=a,e.exports=t.default},2539:function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function s(e,t,a){var s=e.getStore(r.default).getState(),i={lang:s.lang,region:s.region,oauthConsumerKey:s.oauthConsumerKey,oauthConsumerSecret:s.oauthConsumerSecret},l=Object.assign({},t,i);if(!l.guid||!l.oauthConsumerSecret||!l.oauthConsumerKey)return a();var u={userId:l.guid,sortBy:l.sortBy||n(517).DEFAULT_SORT,index:l.nextIndex||null,count:l.count||10,lang:l.lang||"en-US",region:l.region||"US",oauthConsumerKey:l.oauthConsumerKey,oauthConsumerSecret:l.oauthConsumerSecret};e.service.read("canvass.getUserMessageHistory",u,{},function(t,n){if(t||!n||n.error)return e.dispatch("CANVASS_USER_HISTORY_GET_FAILURE",t),a&&a();var s=n.canvassMessages||[];e.dispatch("CANVASS_USER_HISTORY_GET_SUCCESS",{messageList:s,instanceId:l.instanceId,count:n.total&&n.total.count||0,startIndex:(0,o.default)(s,[0,"index"],null),nextIndex:(0,o.default)(s,[s.length-1,"index"],null),sortBy:u.sortBy,showNextClicked:l.showNextClicked,guid:l.guid,image:l.image,name:l.name}),a&&a()})}Object.defineProperty(t,"__esModule",{value:!0});var o=a(n(2)),r=a(n(117));s.displayName="loadUserMessages",t.default=s,e.exports=t.default},2540:function(e,t,n){"use strict";function a(e,t,n){if(!parent||parent===window)return n&&n();var a;if(t.hasOwnProperty("height"))a=t.height;else{a=(document.querySelector(".render-target-active")||document.scrollingElement||document.body).scrollHeight}a!==s&&(s=a,parent.postMessage(JSON.stringify({context:t.context,count:t.count||0,height:s,initialized:!0,isCanvass:!0,isExpanded:t.isExpanded}),"*")),n&&n()}Object.defineProperty(t,"__esModule",{value:!0}),t.default=a;var s;e.exports=t.default},2541:function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),l=a(n(0)),u=a(n(1)),c=a(n(5)),d=a(n(3297)),f=function(e){function t(){return s(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return r(t,e),i(t,[{key:"renderCommentNode",value:function(e,t){var n=this.props,a=n.cpos,s=void 0===a?null:a,o=n.deepLink,r=void 0===o?{}:o,i=e.tags,l=e&&e.meta&&e.meta.contextInfo||{},f=l.url||n.parentContextUrl||"",p=l.displayText||n.parentContextDisplayText||"",m=r.replyId&&r.replyId===e.replyId,h=!m&&!e.replyId&&r.messageId===e.messageId,g=(0,c.default)(n.itemClassName,{"Bgc(#f4f9ff)":m||h}),y=null===s;return u.default.createElement(d.default,{className:g,contextId:e.contextId,cpos:y?t:s,data:e,isReadOnly:n.isReadOnly,key:"comment-"+(e.replyId||e.messageId),messageNamespace:e.namespace,parentContextDisplayText:p,parentContextUrl:f,parentTags:y&&i.length?i:[],pos:y?null:t,replySortBy:n.replySortBy,seeMore:this.context.componentConfig.ui.seeMore,sortBy:n.sortBy})}},{key:"render",value:function(){var e=this.props,t=e.list;return t&&t.length?u.default.createElement("ul",{className:(0,c.default)("comments-list List(n) Ovs(touch) Pos(r)",e.className)},t.map(this.renderCommentNode,this)):null}}]),t}(n(1).PureComponent);f.defaultProps={cpos:null,isReadOnly:!1,itemClassName:"",list:[],sortBy:""},f.contextTypes={componentConfig:l.default.object.isRequired},t.default=f,e.exports=t.default},2542:function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function s(e){return e.getIn(["gifs",0,"image","resolutions"])}function o(e){return e.get("blogName","")}Object.defineProperty(t,"__esModule",{value:!0});var r=a(n(11)),i=a(n(335)),l=a(n(2));t.default=(0,i.default)({storeName:"CanvassTumblrStore",statics:{handlers:{TUMBLR_RELOAD:"reloadCache",TUMBLR_LOAD_GIFS:"loadGifs",TUMBLR_LOAD_GIFS_ERROR:"loadGifsError"}},initialize:function(){this._state=r.default.fromJS({data:{}})},reloadCache:function(){return this.emitChange()},loadGifs:function(e){var t=e.key,n=r.default.fromJS(e.data.gifresult),a=(0,l.default)(e,["data","offset"],0),i=n.map(s),u=n.map(o);e.offset&&this.get("data").getIn([t]).size&&(i=this.get("data").getIn([t,"stickers"]).concat(i),u=this.get("data").getIn([t,"authors"]).concat(u)),this.mergeState({data:this.get("data").mergeIn([t],{stickers:i,authors:u,offset:a,error:null})})},loadGifsError:function(e){var t=e.key,n=this.get("data").getIn([t,"error"]),a=e.error||"TUMBLR_LOAD_ERROR";if(a===n)return this.emitChange();var s=null,o=null;e.offset&&this.get("data").getIn([t]).size&&(s=this.get("data").getIn([t,"stickers"]),o=this.get("data").getIn([t,"authors"])),this.mergeState({data:this.get("data").mergeIn([t],{stickers:s,authors:o,offset:e.offset,error:a})})}}),e.exports=t.default},2765:function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=a(n(11));t.default=(0,a(n(335)).default)({storeName:"CanvassSentimentsStore",handlers:{CANVASS_GET_SENTIMENTS_SUCCESS:"_getSentimentsSuccess"},initialize:function(){this._state=s.default.fromJS({sentiments:{}})},_getSentimentsSuccess:function(e){e.instanceId&&e.sentiments&&this.mergeState(this._state.setIn(["sentiments",e.instanceId],s.default.fromJS(e.sentiments)))},getSentiments:function(e){return this._state.getIn(["sentiments",e],s.default.List())}}),e.exports=t.default},2766:function(e,t,n){"use strict";function a(e,t,n){function a(t,a){if(t||!a||a.error)return e.dispatch("CANVASS_VOTE_FAILURE",t),n();e.dispatch("CANVASS_VOTE_SUCCESS",u),n()}var o={},r="clear"===t.voteType?"delete":"update",i=t.replyId?"canvass.voteReply_ns":"canvass.voteMessage_ns",l=e.getStore(s.default).getState(),u=Object.assign({lang:l.lang,region:l.region,oauthConsumerKey:l.oauthConsumerKey,oauthConsumerSecret:l.oauthConsumerSecret},t);"update"===r?e.service.update(i,u,o,{},function(e,t){a(e,t)}):"delete"===r&&e.service.delete(i,u,{},function(e,t){a(e,t)})}Object.defineProperty(t,"__esModule",{value:!0}),t.default=a;var s=function(e){return e&&e.__esModule?e:{default:e}}(n(117));e.exports=t.default},2767:function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},l=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),u=a(n(0)),c=a(n(1)),d=a(n(1597)),f=(0,n(21).createI13nNode)("textarea",{bindClickEvent:!0}),p=function(e){function t(e){s(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return(0,d.default)(n,["onKeyDown"]),n.state={height:"auto",rows:n.props.rows},n}return r(t,e),l(t,[{key:"componentDidMount",value:function(){var e=this.props.value,t=e&&e.length;if(t){var a=(0,n(10).findDOMNode)(this);a&&(a.value=e,a.setSelectionRange&&a.setSelectionRange(t,t))}}},{key:"componentDidUpdate",value:function(e,t){t.rows!==this.state.rows&&this.context.handleResize()}},{key:"onKeyDown",value:function(e){if("Enter"===e.key&&this.setState({rows:this.state.rows+1}),"Backspace"===e.key&&1!==this.state.rows){var t=e.target.value.split("\n");t[t.length-1]||this.setState({rows:this.state.rows-1})}}},{key:"render",value:function(){var e=Object.assign({},this.props);return delete e.hasAutoExpand,delete e.value,c.default.createElement(f,i({},e,{i13nModel:(0,n(1471).getI13nModel)("text-input"),onKeyDown:this.onKeyDown,rows:this.state.rows,style:{resize:"none"}}))}}]),t}(n(1).PureComponent);p.defaultProps={className:"text-area",hasAutoExpand:!0},p.contextTypes={handleResize:u.default.func.isRequired},t.default=p,e.exports=t.default},2768:function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),l=a(n(0)),u=a(n(1)),c=a(n(1597)),d=a(n(2)),f=a(n(2317)),p=a(n(525)),m=function(e){function t(e,a){s(this,t);var r=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),i=(0,d.default)(a,["componentConfig","ui","loginSrc"]);return(0,c.default)(r,["setLoginLink"]),r.state={loginUrl:(0,n(2218).getLoginUrl)(a,e.messageId,e.replyId,i)},r}return r(t,e),i(t,[{key:"componentWillMount",value:function(){this.onLoginClick=this.onLoginClick.bind(this)}},{key:"componentDidMount",value:function(){this.loginLink.focus()}},{key:"handleClickOutside",value:function(e){this.props.handleToggleToolTip()}},{key:"onLoginClick",value:function(){var e=this.context;e.executeAction(f.default,{context:e.context,loginUrl:this.state.loginUrl})}},{key:"setLoginLink",value:function(e){this.loginLink=(0,n(10).findDOMNode)(e)}},{key:"render",value:function(){var e=this.context,t=this.props,a=t.className,s=e.session.dimensions.authed,o=this.state.loginUrl,r="CANVASS_PLEASE_SIGN_IN"+("2"===s?"_AGAIN":"");return u.default.createElement("div",{className:"tooltip Bgc(#fff) Bd Bdrs(3px) Bdc(#d8dade) Pos(a) Z(1) Whs(nw) Start(50%) TranslateX(-50%)"+(a?" "+a:"")},u.default.createElement(n(1471).I13nAnchor,{className:"tooltip-signin C($fg-link) D(ib) P(10px)",follow:!1,href:o,i13nModel:(0,n(1471).getI13nModel)("login"),onClick:this.onLoginClick,ref:this.setLoginLink,target:"_top"},e.intl.formatMessage({id:r})))}}]),t}(n(1).PureComponent);m.contextTypes={componentConfig:l.default.object.isRequired,context:l.default.string,executeAction:l.default.func.isRequired,intl:l.default.object,session:l.default.object},t.default=(0,p.default)(m),e.exports=t.default},2769:function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=a(n(0)),o=a(n(1)),r=a(n(5)),i=a(n(1303)),l=a(n(2316)),u=a(n(2770)),c=(0,n(21).createI13nNode)(i.default,{isLeafNode:!1}),d=function(e,t){var a=e.creator,s=e.fromCommentForm,i=void 0===s?null:s,l=e.imageUrl,u=e.isReadOnly,d=e.isReply,f=t.guid,p=t.intl,m=t.isUserMessageHistory,h=t.handleUserMessages,g=t.pos,y=void 0===g?null:g,v=a===f,x=h&&!m&&!u,b=e.name;b=b||p.formatMessage({id:"CANVASS_ANONYMOUS"});var S=x?h.bind(void 0,a,l,b):null,C=v?p.formatMessage({id:"CANVASS_SEE_MY_HISTORY"}):p.formatMessage({id:"CANVASS_SEE_USERS_HISTORY"},{user:b}),_=(0,r.default)("Bdrs(46.5%) Pos(a) Start(0)",{"Cur(p)":x}),E=x?n(21).I13nButton:n(21).I13nDiv,M=(0,r.default)("D(ib) Fw(b) P(0) Bd(0) M(0) Mend(10px) Fz(14px) Ta(start)",{"C($c-fuji-grey-l)":!x,"C($c-fuji-blue-1-a)":x}),k=d||null!==y?28:40;return[o.default.createElement(c,{bindClickEvent:x,i13nModel:(0,n(1471).getI13nModel)("user-avatar-tap"),key:"avatar",className:_,enableAlphatar:!0,forceLoad:!0,name:b,onClick:S,size:k,src:l,title:m?"":C}),i?null:o.default.createElement(E,{"aria-label":x?C:void 0,bindClickEvent:x,className:M,i13nModel:(0,n(1471).getI13nModel)("user-name-tap"),key:"username",onClick:S},b)]},f=function(e,t){var a=t.intl,s=e.fromCommentForm,i=e.activityAt,c=e.createdAt,f=e.isReply,p=e.replyCount,m=e.sortBy,h=(0,r.default)("Fz(13px)",{"Mend(20px)":!s,"Mt(14px) Fl(start)":s,"Mt(20px)":s&&f}),g="newest"===m&&p&&i&&i!==c,y=t.isUserMessageHistory&&e.replyId&&null===e.pos;return o.default.createElement("div",{className:h},d.call(void 0,e,t),c?o.default.createElement(l.default,null,o.default.createElement("span",{className:"C($c-fuji-grey-g) Fz(12px)"},o.default.createElement("span",{className:y?"Mend(12px)":void 0},a.formatRelative(c)),g?o.default.createElement("span",null,o.default.createElement("i",{"aria-hidden":"true",className:"Mx(8px)"},"•"),a.formatMessage({id:"CANVASS_LAST_REPLY_TIME"},{timeAgo:a.formatRelative(i)})):void 0,y?o.default.createElement("span",{className:"Whs(nw)"},o.default.createElement(n(31).Icon,{asset:u.default,className:"Mend(2px) Mb(2px)",color:"#878c91",cursorClass:"Cur(d)",height:12,width:12,style:{verticalAlign:"middle"}}),a.formatMessage({id:"CANVASS_REPLIED"})):void 0)):null)};f.contextTypes={guid:s.default.string,handleUserMessages:s.default.func,intl:s.default.object.isRequired,isUserMessageHistory:s.default.bool,pos:s.default.number},t.default=f,e.exports=t.default},2770:function(e,t){if(void 0===n)var n={};n.reply={name:"reply",height:20,width:25,path:"M12.8 5.8V2.4c0-.4-.2-.7-.6-.8-.3-.2-.8-.1-1.1.1L.9 8.8c-.2.2-.4.4-.4.7s.2.6.4.8l10.2 7.1c.3.2.7.3 1.1.1.3-.2.6-.5.6-.8v-3.3h1.3c3 0 6.1.6 8.5 5.2.2.3.5.5.9.5h.3c.5-.1.8-.6.7-1C23 7.3 18.5 5.9 12.8 5.8zm-.1 5.6h-1c-.6 0-1 .4-1 .9v2.4L3.2 9.5l7.5-5.2v2.4c0 .5.5.9 1 .9 4.2 0 7.9 0 9.8 6.3-2.9-2.6-6.3-2.6-8.8-2.5z"},void 0!==e&&e.exports&&(e.exports=n.reply)},2771:function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),l=a(n(0)),u=a(n(1)),c=a(n(2043)),d=a(n(1597)),f=a(n(2)),p=a(n(2316)),m=a(n(93)),h=function(e){function t(e){s(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return(0,d.default)(n,["handleClick","handleImgError","handleRemoveImage"]),n}return r(t,e),i(t,[{key:"handleRemoveImage",value:function(e){this.props.onLinkUpdate(!1,!0),(0,n(1471).fireRapidClick)({slk:"link-prvw-close",elm:"cmmt_link",itc:1,outcm:"close"}),e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()}},{key:"handleImgError",value:function(e){e.target.classList.add("D(n)!")}},{key:"handleClick",value:function(){var e=this.props,t=e.enhancedLink;if(e.fromStream){var a=this.context.i13n.getI13nNode().getMergedModel();a.slk="smartlink",a.elm="cmmt_link",a.itc=0,a.outcm="navigate",(0,n(1471).fireRapidClick)(a),t.url&&window.open(t.url)}}},{key:"renderImg",value:function(){var e=this.props.enhancedLink,t=(0,f.default)(e,["image","url"],null);return t&&u.default.createElement(p.default,null,u.default.createElement("img",{alt:e.title,className:"D(b) Bxz(bb) Mih(100px) Mah(200px) Maw(145px) W(a) Mend(5px) P(5px) Fl(start) Maw(n)--xxs W(100%)--xxs Fl(n)--xxs",onError:this.handleImgError,src:t}))}},{key:"render",value:function(){var e=this.props,t=e.enhancedLink,a=e.fromStream,s=this.context,o=s.contextId,r=s.tags;if(!t)return null;var i=t.title,l=void 0===i?"":i,d=t.description,f=void 0===d?"":d,p=t.url,h=p.indexOf("://")>-1?p.split("/")[2]:p.split("/")[0];a||(0,n(1471).fireRapidEvent)("secvw",{slk:"link-prvw-"+p,elm:"cmmnt_link",itc:1,outcm:"show",cat:r,g:o});var g=c.default.dedupe("Cf Bxsh(boxShadow) Mx(14px) panel Pos(r) Miw(150px) Lh(14px) Bgc(#fff) Bg(#fff) Bdrs(3px) Bdc(#d9d9d9) Bds(s) Bdw(1px) Mb(10px)",{"Cur(p) Mx(0) Mb(5px)":a});return u.default.createElement(n(21).I13nDiv,{bindClickEvent:!1,className:g,onClick:this.handleClick},this.renderImg(),u.default.createElement("div",{className:"P(5px)"},!1===a?u.default.createElement(n(1471).I13nButton,{className:"Pos(a) End(-10px) T(-10px) Bgc(#000) Op(0.8) Bdrs(50%) M(0) P(0) W(21px) H(21px)",i13nModel:(0,n(1471).getI13nModel)("link-prvw-close"),onClick:this.handleRemoveImage},u.default.createElement(n(31).Icon,{asset:m.default,width:13,height:13,color:"#fff",className:"Va(bl)!"})):null,u.default.createElement("div",{className:"LineClamp(2,54px) Fz(16px) Pt(5px) C($c-fuji-blue-4-b) Lh(18px) Mah(54px) Fw(500) Ov(h) Tov(e)"},l),u.default.createElement("div",{className:"LineClamp(2,42px) D(n)!--xxs Fz(13px) Mt(10px) Lh(14px) Mah(42px) Ov(h) Tov(e)"},f),u.default.createElement("div",{className:"Fz(11px) Td(n) Fw(n) D(ib) Mt(5px)!--xxs Mt(10px) Ell"},h)))}}]),t}(n(1).PureComponent);h.contextTypes={configStoreState:l.default.object,contextId:l.default.string,cpos:l.default.number,i13n:l.default.object,isUserMessageHistory:l.default.bool,pos:l.default.number,tags:l.default.string,userMessageHistoryGuid:l.default.string},t.default=h,e.exports=t.default},2772:function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function i(e,t){var n=e.getStore(C.default),a=e.getStore(S.default),s=e.getStore(v.default),o=s.isActiveForm(t),r=s.getActiveForm();return{guid:n.getGUID(),isActive:o,isHidden:!o&&t.forReply&&(r.messageId===t.messageId||t.replyId),isProfileLoaded:a.isLoaded(),isSignedIn:n.isSignedIn(),userProfile:a.getProfile(),enhancedLink:Object.assign({},e.getStore(b.default).getState()),commentForm:Object.assign({},s.getState()),configStoreState:Object.assign({},e.getStore(x.default).getState())}}Object.defineProperty(t,"__esModule",{value:!0}),t.CommentForm=void 0;var l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},u=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),c=a(n(0)),d=a(n(1)),f=a(n(2043)),p=a(n(1597)),m=a(n(5)),h=a(n(2)),g=a(n(509)),y=a(n(307)),v=a(n(2315)),x=a(n(117)),b=a(n(2773)),S=a(n(305)),C=a(n(82)),_=a(n(3305)),E=a(n(589)),M=a(n(2774)),k=a(n(2317)),T=a(n(3306)),I=a(n(3307)),O=a(n(2769)),N=a(n(1296)),w=a(n(1304)),A=a(n(2771)),P=a(n(3308)),R=a(n(3309)),L=a(n(2767)),j=a(n(3310)),F=a(n(2775)),B=t.CommentForm=function(e){function t(e,a){s(this,t);var r=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),i=(0,h.default)(a,["componentConfig","ui","loginSrc"]);return r.state={activeTab:null,commenting:!1,enableRelatedTags:!1,enhancedLink:!1,enhancedLinkRemoved:!1,errorStatus:null,loginUrl:(0,n(2218).getLoginUrl)(a,e.messageId,e.replyId,i),posting:!1,selectedUserLabel:null,titleHovered:!1,validComment:!1},(0,p.default)(r,["handleBlur","handleCloseCommentForm","handleFocus","handleHeartbeatInterval","handleKeyUp","handleLinkUpdate","handleLoginLink","handlePaste","handlePost","handleRelatedTags","handleRemoveRelatedTags","handleShowTumblrStickers","handleSubmit","handleTitleClick","handleUserIdle","handleUserLabelSelection","onKeyDown","onTitleHover"]),r}return r(t,e),u(t,[{key:"componentWillMount",value:function(){var e=this.context;this.canvassStore=e.getStore(y.default),this.commentFormStore=e.getStore(v.default)}},{key:"componentDidMount",value:function(){var e=this;e.handleCommentChanged(!!e.getCommentText()),e.props.isProfileLoaded||e.context.executeAction(E.default),setImmediate(function(){e.handleReplyFormInFocus()})}},{key:"componentWillUnmount",value:function(){this.setCommentingState(!1),clearTimeout(this.heartbeat),clearTimeout(this.userIdleTimer),this.commentFormStore.setFormInactive(this.props)}},{key:"getCommentText",value:function(){return(((0,n(10).findDOMNode)(this.refs.commentText)||{}).value||"").trim()}},{key:"handleCloseCommentForm",value:function(){this.props.handleCloseCommentForm()}},{key:"handleReplyFormInFocus",value:function(){var e=this.props,t=e.isSignedIn?(0,n(10).findDOMNode)(this.refs.commentText):(0,n(10).findDOMNode)(this.refs.loginPrompt);e.replyFormInFocus&&t&&t.focus()}},{key:"componentDidUpdate",value:function(){this.handleReplyFormInFocus(),this.context.handleResize()}},{key:"componentWillReceiveProps",value:function(e){var t=e.enhancedLink,a=e.commentForm,s=e.forReply,o=this.refs.submit,r=this.props,i=!r.isHidden&&e.isHidden,l=void 0;if(o&&this.state.posting&&!a.errorMessage&&(s&&a.messageId===r.messageId&&a.replyId||!s&&a.messageId&&!a.replyId)){this.handleLinkUpdate(!1,!1),this.setState({activeTab:null,commenting:!1,posting:!1,selectedUserLabel:null,validComment:!1}),l={animated_gif_count:(0,h.default)(a,["details","imageMessageDetails","length"])||0,msg_id:a.replyId||a.messageId,rcv_msg_id:a.replyId?a.messageId:null,smartlink_count:(0,h.default)(a,["details","linkMessageDetails","length"])||0,tags_count:a.tags.length};(0,n(10).findDOMNode)(this.refs.commentText).value="",i=!0}a.messageId===r.messageId&&"CANVASS_NETWORK_ERROR"===a.errorMessage&&(this.setState({errorStatus:"CANVASS_NETWORK_ERROR",posting:!1}),i=!1,this.commentFormStore.initialize(),l={slk:"fail"}),t.messageId!==r.messageId||!t.title||r.enhancedLink&&t.url===r.enhancedLink.url||(this.handleLinkUpdate(t,!1),this.context.getStore(b.default).initialize(),i=!1),e.handleCloseCommentForm&&i&&e.handleCloseCommentForm(),o&&l&&(0,n(1471).fireRapidClick)(Object.assign({},o.getI13nNode().getMergedModel(),l))}},{key:"onKeyDown",value:function(e){"Escape"===e.key&&"tumblrStickers"===this.state.activeTab&&this.setState({activeTab:null})}},{key:"toggleActiveTab",value:function(e){var t=this.state,n=t.activeTab!==e?e:null;this.setState({activeTab:n,enhancedLink:!1}),this.setCommentingState(!!n||t.validComment)}},{key:"enhanceLink",value:function(e){var t=this.props,a=this.state,s=t.configStoreState;if(!a.enhancedLinkRemoved&&!a.enhancedLink&&"tumblrStickers"!==a.activeTab){var o=(0,n(122).matchLinks)(e);o&&this.context.executeAction(_.default,{url:o[0],messageId:t.messageId,lang:s.lang,region:s.region,oauthConsumerKey:s.oauthConsumerKey,oauthConsumerSecret:s.oauthConsumerSecret})}}},{key:"handleShowTumblrStickers",value:function(){(0,n(10).findDOMNode)(this.refs.commentText).focus(),this.toggleActiveTab("tumblrStickers")}},{key:"handleLinkUpdate",value:function(e,t){this.getCommentText()||(t=!1),this.setState({activeTab:e&&"linkPreview",enhancedLink:e,enhancedLinkRemoved:t})}},{key:"handleFocus",value:function(){this.commentFormStore.setActiveForm(this.props),this.setState({activeTab:this.state.activeTab,errorStatus:null,posting:!1})}},{key:"handleBlur",value:function(){var e=this.props;e.replyFormInFocus&&e.handleReplyFormBlur()}},{key:"setCommentingState",value:function(e,t){var n=this,a=n.context,s=n.props,o=n.state.commenting!==e;if(o&&n.setState({commenting:e}),t||o){var r=(0,h.default)(a,["componentConfig","ui","presence","enabled"]),i=r||(0,h.default)(a,["componentConfig","ui","presence","heartbeat"]),l=s.configStoreState.notificationInterval;i&&l&&(e&&!n.heartbeat&&(n.heartbeat=setInterval(n.handleHeartbeatInterval,1e3*l)),a.executeAction(I.default,{context:a.context,eventType:e?"START_TYPING":"STOP_TYPING",messageId:s.messageId,namespace:s.messageNamespace||a.namespace}))}}},{key:"handleUserIdle",value:function(){this.setCommentingState(!1)}},{key:"handleHeartbeatInterval",value:function(){if(this.state.commenting){"visible"===(document&&document.visibilityState||"visible")&&this.context.renderTarget.isActive()?this.setCommentingState(!0,!0):this.setCommentingState(!1)}}},{key:"handleCommentChanged",value:function(e){this.props.configStoreState.notificationInterval&&e&&(clearTimeout(this.userIdleTimer),this.userIdleTimer=setInterval(this.handleUserIdle,6e4)),this.state.validComment!==e&&(this.setState({validComment:e}),this.setCommentingState(e))}},{key:"handlePaste",value:function(e){var t=e.clipboardData||e.originalEvent.clipboardData||window.clipboardData,n=t.getData("text");this.handleCommentChanged(this.state.validComment||!!n),this.props.configStoreState.allowSmartlinks&&n&&this.enhanceLink(n)}},{key:"handleKeyUp",value:function(e){var t=this.props.configStoreState.allowSmartlinks,n=e.target.value.trim();n||t&&this.state.enhancedLinkRemoved&&this.setState({enhancedLinkRemoved:!1}),t&&32===e.keyCode&&this.enhanceLink(n),this.handleCommentChanged(!!n)}},{key:"handlePost",value:function(e,t){var a=this.context,s=this.props,o=(0,n(10).findDOMNode)(this.refs.commentText),r=o.value.trim(),i=this.state.enhancedLink,l=this.state.selectedUserLabel?[this.state.selectedUserLabel]:[];if(!r&&!i&&!e)return void this.setState({errorStatus:"CANVASS_MISSING_COMMENT"});this.setState({errorStatus:null,posting:!0}),this.context.executeAction(T.default,{author:t,content:r,context:a.contextId||a.context,contextDisplayText:a.contextDisplayText,contextUrl:a.contextUrl,enhancedLink:i,forReply:s.forReply||!1,instanceId:a.instanceId,isUserMessageHistory:a.isUserMessageHistory,mentions:s.mentions,messageId:s.messageId,messageNamespace:s.messageNamespace||"",namespace:a.namespace,parentContextDisplayText:s.parentContextDisplayText||"",parentContextUrl:s.parentContextUrl||"",replyId:s.replyId,sticker:e,userLabels:l})}},{key:"handleSubmit",value:function(e){e.preventDefault(),this.handlePost()}},{key:"handleLoginLink",value:function(){var e=this.context;e.executeAction(k.default,{context:e.context,loginUrl:this.state.loginUrl})}},{key:"handleUserLabelSelection",value:function(e){this.setState({selectedUserLabel:e})}},{key:"renderErrorBox",value:function(){return this.state.errorStatus?d.default.createElement("div",{className:"error-box C($c-fuji-red-2-b) Pstart(12px) Pb(10px)"},d.default.createElement(n(31).Icon,{name:"attention",width:16,height:16,color:"#ff333c",className:"D(ib) Va(tb)! Mend(7px)"}),d.default.createElement(n(35).FormattedMessage,{id:this.state.errorStatus})):null}},{key:"renderLoadingBox",value:function(){return this.state.posting?d.default.createElement("div",{className:"H(100%) Bg(bgLoading) Op(0.7) C($c-fuji-grey-g) Bgz(35px) Pos(a) B(0) W(100%) Z(1)"}):null}},{key:"renderLoginPrompt",value:function(){var e=this.context,t=this.props;if(t.isFullScreen)return null;if(t.isReadOnly)return this.renderCommentsTitle();var a=e.session.dimensions.authed,s=t.deepLink,o=t.forReply,r="CANVASS_SIGN_IN"+("2"===a?"_AGAIN":""),i=o?r+"_POST_REPLY":r+"_POST_COMMENT",l=(0,m.default)("Mb(15px)",{"Mt(18px)":o,"Mend(15px)":s&&!s.replyId});return d.default.createElement("div",{className:l},this.renderCommentsTitle(),this.renderRelatedTags(),d.default.createElement(n(1471).I13nAnchor,{className:"comment-form D(ib) Bxz(bb) W(100%) P(6px) Bds(s) Bdw(1px) Bdc(#e2e2e2) Fz(13px) C($c-fuji-blue-1-a) O(n):h O(n):a",target:"_top",ref:"loginPrompt",follow:!1,href:this.state.loginUrl,onBlur:this.handleBlur,onClick:this.handleLoginLink,onFocus:this.handleFocus,i13nModel:(0,n(1471).getI13nModel)("login",this.getI13nModel())},d.default.createElement("span",{className:"label D(ib) Va(m) Fw(500) Pstart(8px)"},d.default.createElement(n(35).FormattedMessage,{id:i}))))}},{key:"renderRelatedTags",value:function(){var e=this.props,t=this.state.enableRelatedTags;return t&&e.commentsExpanded&&!e.readOnly?d.default.createElement(w.default,{component:"div",transitionName:"action",transitionAppear:!0,transitionAppearTimeout:250,transitionEnterTimeout:250,transitionLeaveTimeout:250},d.default.createElement(P.default,{enableRelatedTags:t,handleRemoveRelatedTags:this.handleRemoveRelatedTags,relatedTags:e.relatedTags,selectedTags:e.selectedTags})):null}},{key:"handleRemoveRelatedTags",value:function(){this.canvassStore.resetRelatedTags(this.context.instanceId),this.setState({enableRelatedTags:!1}),this.context.handleOverlay(!1)}},{key:"handleRelatedTags",value:function(){var e=this.props,t=this.context,a=e.configStoreState;t.handleOverlay(!0),this.setState({enableRelatedTags:!0}),this.context.executeAction(M.default,{context:t.context,instanceId:t.instanceId,lang:a.lang,namespace:t.namespace,oauthConsumerKey:a.oauthConsumerKey,oauthConsumerSecret:a.oauthConsumerSecret,region:a.region,tagsAnd:(0,n(122).joinFilterTags)(t.tagsAnd,e.selectedTags),tagsOr:t.tagsOr})}},{key:"handleTitleClick",value:function(){var e=this.props;e.enableTitleClick&&e.count>0&&e.onTitleClick&&e.onTitleClick()}},{key:"onTitleHover",value:function(){var e=this;e.props.enableTitleClick&&e.props.count>0&&e.setState({titleHovered:!e.state.titleHovered})}},{key:"getHeading",value:function(){var e=this.props,t=e.count,n=this.context,a=n.intl,s=n.contextDisplayText,o=n.componentConfig.ui.showContextDisplayText,r=a.formatNumber(t),i="";if(e.commentsExpanded)switch(t){case 0:i=a.formatMessage({id:"CANVASS_BE_THE_FIRST"});break;case 1:i=o&&s?a.formatMessage({id:"CANVASS_HEADING_WITH_ONE_MESSAGE_WITH_TITLE"},{title:s}):a.formatMessage({id:"CANVASS_HEADING_WITH_ONE_MESSAGE"});break;default:i=o&&s?a.formatMessage({id:"CANVASS_HEADING_WITH_MORE_THAN_ONE_MESSAGE_WITH_TITLE"},{count:r,title:s}):a.formatMessage({id:"CANVASS_HEADING_WITH_MORE_THAN_ONE_MESSAGE"},{count:r})}else i=t?a.formatMessage({id:"CANVASS_VIEW_COMMENTS"},{count:r}):a.formatMessage({id:"CANVASS_BE_THE_FIRST"});return i}},{key:"renderHeading",value:function(){var e=this.props,t=this.state,a=e.enableTitleClick&&e.count>0,s=(0,m.default)("comments-title D(ib) Td(n) Bd(0) P(0) Fw(b) Fz(16px)",{"Cur(p)":a,"C($c-fuji-blue-1-a)":t.titleHovered,"C(#000)":!t.titleHovered}),o=(0,n(1471).getI13nModel)(e.commentsExpanded?"comments-open":"comments-close");return d.default.createElement(n(1471).I13nButton,{bindClickEvent:a,className:s,onClick:a?this.handleTitleClick:null,onMouseEnter:a?this.onTitleHover:null,onMouseLeave:a?this.onTitleHover:null,i13nModel:o},d.default.createElement(n(31).Icon,{asset:N.default,className:"comment-icon Mend(7px)",color:this.state.titleHovered?"#188fff":"#000",style:{verticalAlign:"middle"},height:21,width:21}),this.getHeading())}},{key:"renderCommentsTitle",value:function(){var e=this.props;if(e.forReply)return null;var t=e.configStoreState,a=e.isReadOnly,s=e.sentiments,o=t.enableSentiments&&s&&s.size?d.default.createElement(R.default,{className:"Fl(end) Fz(13px) Fw(n) Whs(nw) Pos(r) Cur(p) Z(1)",sentiments:s}):null;return d.default.createElement("div",{className:(0,m.default)("comment-heading Pend(6px) C(#000)",{"Py(15px)":!a,"Pt(15px)":a})},d.default.createElement("div",{className:"D(ib)"},this.renderHeading(),t.enableRelatedTags&&e.commentsExpanded?d.default.createElement(n(1471).I13nButton,{type:"button",onClick:this.handleRelatedTags,className:"related-tags-add-btn Mstart(5px)! Cur(p) O(n):h O(n):a Va(t) P(0) M(0) Bd(n)"},d.default.createElement(n(31).Icon,{name:"plus-circle",style:{verticalAlign:"middle"},width:15,height:15,color:"#188fff"})):null),o)}},{key:"renderActiveTab",value:function(){switch(this.state.activeTab){case"linkPreview":return d.default.createElement(A.default,{enhancedLink:this.state.enhancedLink,onLinkUpdate:this.handleLinkUpdate,fromStream:!1,isUserMessageHistory:this.context.isUserMessageHistory});case"tumblrStickers":return d.default.createElement(j.default,{onStickerClick:this.handlePost});default:return null}}},{key:"getI13nModel",value:function(){var e=this.props;return{cpos:e.forReply?e.cpos:null,reply_lv:e.replyId?2:e.forReply?1:0}}},{key:"renderUserLabels",value:function(){var e=this.context,t=(0,h.default)(e,["componentConfig","ui","userLabels"])||{};if(t.enable){var n=this.props.isFullScreen,a=(0,m.default)("Pos(r) Pt(5px) Pb(10px)",{"Pstart(16px)":!n});return d.default.createElement(F.default,l({className:a,handleSelection:this.handleUserLabelSelection,isReadOnly:!1,selectedValue:this.state.selectedUserLabel},t))}}},{key:"renderUploadOptions",value:function(){var e=this.state.activeTab,t=this.context,a=this.props,s=a.forReply,o=a.isFullScreen,r=a.configStoreState.allowAnimatedGIF,i="tumblrStickers"===e?"#188fff":"#878c91",l=f.default.dedupe("Pos(r)",{"Px(2px)":o&&!s,"Pstart(16px) Pb(10px)":!o,"H(20px)":!r,"Pstart(10px)":s}),u="tumblrStickers"===e?{slk:"gif hide",outcm:"hide"}:{slk:"gif show",outcm:"show"};return d.default.createElement("div",{className:l},r?d.default.createElement(n(1471).I13nButton,{"aria-label":t.intl.formatMessage({id:"CANVASS_SHOW_GIFS"}),className:"Va(m) O(n):h O(n):a P(0) M(0) Bd(n)",i13nModel:(0,n(1471).getI13nModel)("tumblr-icon",u),onClick:this.handleShowTumblrStickers,type:"button"},d.default.createElement(n(31).Icon,{name:"gif",height:23,color:i})):null)}},{key:"renderSubmitButton",value:function(){var e=this.props,t=e.forReply,a=e.isFullScreen,s=this.state,o=s.validComment,r=s.enhancedLink,i=r?{elmt:"link",elm:"cmmt_post"}:{elmt:"text",elm:"cmmt_post"},l=(0,m.default)("comment-submit Fw(600) Bgc(t) Bd(n) O(n):h O(n):a M(0)",{"Pt(6px) Px(12px)":a,"P(12px)":!a,"Fz(14px)":t||a,"Fz(16px)":!t&&!a,"C($c-fuji-blue-1-a)":o||r,"C($c-fuji-grey-c)":!o&&!r}),u=d.default.createElement(n(1471).I13nButton,{bindClickEvent:!1,className:l,disabled:o||r?void 0:"disabled",i13nModel:(0,n(1471).getI13nModel)(t?"reply-post":"comment-post",i),ref:"submit",type:"submit"},this.context.intl.formatMessage({id:t?"CANVASS_REPLY":"CANVASS_POST"}));return d.default.createElement("div",{className:"Pos(a) End(0) B(0)"},this.renderGuidelinesLink(),u)}},{key:"renderGuidelinesLink",value:function(){var e=this.context,t=e.componentConfig&&e.componentConfig.guidelineUrl;if(t)return d.default.createElement(n(1471).I13nAnchor,{className:"C(#9ea2af) Fz(14px) Mend(5px)",href:t,i13nModel:(0,n(1471).getI13nModel)("guidelines"),target:"_blank"},e.intl.formatMessage({id:"CANVASS_GUIDELINES"}))}},{key:"renderTextArea",value:function(){var e=this.props,t=e.configStoreState,n=e.deepLink,a=e.forReply,s=e.messageId,o=e.isFullScreen,r=e.value,i=t.allowAnimatedGIF,l=t.enableRelatedTags,u=t.allowSmartlinks,c=this.context.intl,p="smartphone"===(0,h.default)(this.context,["session","dimensions","device"]),m=f.default.dedupe("Bd(n) Fz(14px) Lh(20px) W(100%) Bxsh(n) C($c-fuji-grey-l)",{"P(2px)":o&&!a,"Pstart(16px) Py(12px)":!o,"Pstart(10px) Pt(10px)":a}),g=void 0;g=a?"CANVASS_POST_REPLY":i&&l&&u?p?"CANVASS_POST_COMMENT_SMARTPHONE_LONG":"CANVASS_POST_COMMENT_LONG":"CANVASS_POST_COMMENT";var y=c.formatMessage({id:g}),v=f.default.dedupe("Pos(r) Ov(h) Bgc(#fff)",{"Mend(8px)":n,"My(13px) Bdc($c-fuji-grey-c) Bd Bdrs(2px)":!o,"Mt(8px) Mb(10px)":o,"Mstart(40px) Mt(16px) Mb(13px)":a,"Mstart(50px)":!a});return d.default.createElement("div",{className:v},d.default.createElement(L.default,{ref:"commentText",className:m,key:"textarea-"+s,maxLength:5e3,onFocus:this.handleFocus,onBlur:this.handleBlur,onKeyUp:this.handleKeyUp,onPaste:this.handlePaste,placeholder:y,rows:1,value:r}),this.renderLoadingBox(),this.renderUserLabels(),this.renderActiveTab(),this.renderUploadOptions(),this.renderSubmitButton())}},{key:"renderForm",value:function(){var e=this.props,t=e.isFullScreen,a=e.isReadOnly,s=e.userProfile,o=f.default.dedupe("Pos(r)",{"Mstart(20px) Mend(10px)":t}),r=d.default.createElement(n(21).I13nDiv,{className:o,i13nModel:this.getI13nModel()},t?void 0:this.renderCommentsTitle(),t?void 0:this.renderRelatedTags(),a?void 0:d.default.createElement(O.default,{creator:e.guid,fromCommentForm:!0,imageUrl:s.imageUrl,isReply:e.forReply,key:"byline-commentform"+e.messageId,name:s.nickName}),a?void 0:d.default.createElement("form",{className:"Ov(h) W(100%) Cf",encType:"multipart/form-data",onKeyDown:this.onKeyDown,onSubmit:this.handleSubmit,ref:"form"},this.renderTextArea(),this.renderErrorBox()));return t?d.default.createElement("div",{className:"Pos(f) Bgc(#fff) Z(2) B(0) Start(0) End(0) BdT Bdc($c-fuji-grey-c)"},r):r}},{key:"render",value:function(){return this.props.isHidden?null:this.props.isSignedIn?this.renderForm():this.renderLoginPrompt()}}]),t}(n(1).PureComponent);B.contextTypes={componentConfig:c.default.object.isRequired,configStoreState:c.default.object.isRequired,context:c.default.string,contextDisplayText:c.default.string,contextId:c.default.string,contextUrl:c.default.string,executeAction:c.default.func.isRequired,getStore:c.default.func,handleOverlay:c.default.func,handleResize:c.default.func.isRequired,instanceId:c.default.string,intl:c.default.object.isRequired,isUserMessageHistory:c.default.bool,namespace:c.default.string,renderTarget:c.default.object.isRequired,session:c.default.object.isRequired,tags:c.default.string,tagsAnd:c.default.string,tagsOr:c.default.string},B.defaultProps={commentsExpanded:!0},t.default=(0,g.default)(B,[C.default,S.default,b.default,v.default,x.default],i)},2773:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=(0,function(e){return e&&e.__esModule?e:{default:e}}(n(18)).default)({storeName:"CanvassLinkEnhancerStore",statics:{handlers:{CANVASS_GET_ENHANCE_URL_SUCCESS:"canvassEnhancedLinkSuccess"}},initialize:function(){this.state={}},canvassEnhancedLinkSuccess:function(e){this.state=e.data,this.state.messageId=e.messageId,this.emitChange()},getState:function(){return this.state},dehydrate:function(){return this.state},rehydrate:function(e){this.state=e}}),e.exports=t.default},2774:function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function s(e,t,a){var s=e.session.query,i=e.getStore(r.default).getState(),l=t.instanceId,u=t.oauthConsumerKey||i.oauthConsumerKey,c=t.oauthConsumerSecret||i.oauthConsumerSecret,d=t.namespace||s.namespace||i.namespace;if(!l||!c||!u)return a("Required fields missing",null);var f=e.getStore(o.default).getCommentsState(l),p=t.tagsAnd||f.tagsAnd||null,m=t.tagsOr||f.tagsOr||null,h=t.context||s.context||"YahooGlobal";if(f.get("relatedTags"))return a&&a();var g={context:h,count:t.count||10,lang:t.lang||i.lang||"en-US",namespace:d,region:t.region||i.region||"US",oauthConsumerKey:u,oauthConsumerSecret:c};g.query=(0,n(122).createSearchQuery)(p,m,h,d),e.service.read("canvass.getTrendingTags_ns",g,{},function(t,n){return t||!n||n.error?a():(e.dispatch("CANVASS_GET_RELATED_TAGS_SUCCESS",{instanceId:l,relatedTags:n}),a())})}Object.defineProperty(t,"__esModule",{value:!0});var o=a(n(307)),r=a(n(117));s.displayName="loadRelatedTags",t.default=s,e.exports=t.default},2775:function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),l=(a(n(0)),a(n(1))),u=a(n(1597)),c=a(n(3313)),d=function(e){function t(e,n){s(this,t);var a=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return e.isReadOnly?o(a):((0,u.default)(a,["handleSelection"]),a)}return r(t,e),i(t,[{key:"handleSelection",value:function(e){this.props.handleSelection(e)}},{key:"getComponentProps",value:function(){var e=this.props,t={className:e.className};return e.isReadOnly||(t=Object.assign({},t,{i13nModel:(0,n(1471).getI13nModel)("userlabels")})),t}},{key:"renderMessage",value:function(){var e=this.props;if(!(e.isReadOnly||!e.prompt||e.prompt.length<1))return l.default.createElement("div",{className:"C($c-fuji-grey-g) Fz(14px) Pb(5px)"},e.prompt)}},{key:"renderUserLabels",value:function(){var e=this.props,t=e.labels;if(t){if(e.isReadOnly){var n=e.userLabels;if(!n||n.length<1)return;var a=Object.keys(t).reduce(function(e,a){return n.includes(a)&&(e[a]=t[a]),e},{});return l.default.createElement("div",{className:"D(ib) Pos(r)"},Object.keys(a).map(function(e,t){var n=a[e];if(n)return l.default.createElement(c.default,{config:n,key:e,value:e})}))}var s=e.selectedValue,o=this.handleSelection;return l.default.createElement("div",{className:"D(ib) Pos(r)"},Object.keys(t).map(function(e,n){var a=e===s,r=t[e];if(r)return l.default.createElement(c.default,{config:r,handleSelection:o,isReadOnly:!1,isSelected:a,key:e,value:e})}))}}},{key:"render",value:function(){return this.props.enable?l.default.createElement(n(21).I13nDiv,this.getComponentProps(),this.renderMessage(),this.renderUserLabels()):null}}]),t}(n(1).PureComponent);d.defaultProps={className:"",isReadOnly:!0,selectedValue:null},t.default=d,e.exports=t.default},2776:function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),l=a(n(0)),u=a(n(1)),c=a(n(1597)),d=a(n(5)),f=a(n(525)),p=a(n(534)),m=a(n(2539)),h=a(n(93)),g=a(n(1288)),y=function(e){function t(e){s(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return(0,c.default)(n,["handleClickOutside","handleFilterClick","handleKeyDown","handleShowMyComments","setSortMenu"]),n.state={menuOpen:!1},n}return r(t,e),i(t,[{key:"componentWillReceiveProps",value:function(e){this.setState({updating:this.props.sortBy!==e.sortBy})}},{key:"componentDidUpdate",value:function(e,t){var n=this;n.state.updating&&setTimeout(function(){n.setState({updating:!1})},1e3),!t.menuOpen&&n.state.menuOpen&&n.sortMenu&&n.sortMenu.focus()}},{key:"handleClickOutside",value:function(){this.setState({menuOpen:!1})}},{key:"handleFilterClick",value:function(e){e&&e.stopPropagation(),this.setState({menuOpen:!this.state.menuOpen})}},{key:"handleKeyDown",value:function(e){e&&27===e.keyCode&&this.state.menuOpen&&(e.preventDefault(),e.stopPropagation(),this.handleClickOutside())}},{key:"handleShowMyComments",value:function(){var e=this.props,t=e.currentUserProfile;this.context.handleUserMessages(e.currentUserGuid,t.imageUrl,t.nickName)}},{key:"handleSort",value:function(e,t){var n=this.context,a=this.props,s=t||[];if(a.sortBy!==e||t!==a.selectedTags){var o=n.instanceId,r=n.userMessageHistoryGuid,i=r?m.default:p.default,l=void 0;l=r?{guid:r,name:a.userMessageHistoryName,image:a.userMessageHistoryImage,sortBy:e,instanceId:o}:{instanceId:o,sortBy:e,tagsAnd:n.tagsAnd,tagsOr:n.tagsOr,selectedTags:s.join(","),context:n.context,contextUrl:n.contextUrl,contextDisplayText:n.contextDisplayText},this.context.executeAction(i,l)}}},{key:"getSortLabel",value:function(e){var t=void 0;switch(e){case n(517).SORT_HIGHEST_RATED:t="CANVASS_SORT_HIGHEST_RATED";break;case n(517).SORT_LATEST:t="CANVASS_SORT_NEWEST";break;case n(517).SORT_NEWEST:t="CANVASS_SORT_RECENT";break;case n(517).SORT_OLDEST:t="CANVASS_SORT_OLDEST";break;case n(517).SORT_MOST_REPLIED:t="CANVASS_SORT_MOST_REPLIED";break;default:return null}return u.default.createElement("span",null,this.context.intl.formatMessage({id:t}))}},{key:"getI13nOverride",value:function(e){return{slk:e}}},{key:"setSortMenu",value:function(e){this.sortMenu=e}},{key:"renderSortOptions",value:function(){if(this.state.menuOpen)return u.default.createElement("ul",{"aria-label":this.context.intl.formatMessage({id:"CANVASS_SORT"}),className:"sorting-tabs Pos(a) Z(1) Bd Bdc($c-fuji-grey-c) Bdrs(3px) Bgc(#fff) Bxsh(boxShadow) Mt(8px) O(n)",ref:this.setSortMenu,role:"menu",tabIndex:"-1"},this.props.arrangement.map(this.renderSortOption,this))}},{key:"renderSortOption",value:function(e){var t=e===this.props.sortBy,a=this.getSortLabel(e);if(!a)return null;var s=(0,d.default)("H(44px)",{selected:t});return u.default.createElement("li",{className:s,key:e},u.default.createElement(n(1471).I13nButton,{className:"sort-by-"+e+" Px(16px) Py(12px) O(n):h O(n):a Cur(p) C($c-fuji-grey-g) Fz(14px) Fw(500) C($c-fuji-blue-1-a):h selected_C($c-fuji-blue-1-a) selected_Fw(b) W(100%) Ta(start)",onClick:this.handleSort.bind(this,e,this.props.selectedTags),role:"menuitem",i13nModel:(0,n(1471).getI13nModel)("sort",this.getI13nOverride(e))},a))}},{key:"handleClickSelectedTag",value:function(e){var t=this.props,n=t.selectedTags,a=void 0===n?[]:n,s=t.sortBy;a=a.filter(function(t){return t!==e}),this.handleSort(s,a)}},{key:"renderSelectedTags",value:function(){var e=this.props,t=e.selectedTags,a=e.selectedTagsCount,s=t&&t.size;if(s>0)return u.default.createElement("div",{className:"D(ib)"},t.map(function(e,t){return u.default.createElement(n(1471).I13nButton,{className:"Fz(12px) Fw(500) Lh(1) P(4px) Pstart(8px) Bdrs(4px) Mend(8px) C(#fff) Bgc($c-fuji-blue-1-a)",i13nModel:{elm:"cmmt_tag",pos:s-1,slk:e},key:"tag-"+t,onClick:this.handleClickSelectedTag.bind(this,e)},"#"+e,u.default.createElement("span",{className:"Fw(n) D(ib) Mx(4px)"},"("+this.context.intl.formatNumber(a)+")"),u.default.createElement(n(31).Icon,{asset:h.default,color:"#fff",height:14,style:{verticalAlign:"text-bottom"},width:14}))},this))}},{key:"renderMyCommentsButton",value:function(){var e=this.context,t=this.props;if(t.myComments&&t.currentUserGuid&&t.currentUserProfile&&!e.isUserMessageHistory)return u.default.createElement(n(1471).I13nButton,{className:"my-comments-button O(n) Fz(14px) Fw(600) C($c-fuji-grey-l) M(0) P(0) Fl(end)",i13nModel:(0,n(1471).getI13nModel)("user-comments-tap",{guid:t.guid}),onClick:this.handleShowMyComments},e.intl.formatMessage({id:"CANVASS_MY_COMMENTS"}))}},{key:"render",value:function(){var e=this,t=e.props,a=t.arrangement,s=t.count,o=t.sortBy,r=e.state.updating;return s<2||Object.keys(a).length<2?null:u.default.createElement("div",{className:"sorting-tabs-container Pos(r) Mt(5px)",onClick:e.handleClickOutside,onKeyDown:e.handleKeyDown},u.default.createElement(n(1471).I13nButton,{"aria-expanded":e.state.menuOpen?"true":void 0,"aria-haspopup":"true","aria-label":e.context.intl.formatMessage({id:"CANVASS_SORT"}),className:"sort-filter-button O(n):h O(n):a Fz(14px) Fw(600) M(0) P(0) Trsdu(.5s) Trsp(color) "+(r?"C($c-fuji-purple-1-a)":"C($c-fuji-grey-l)"),i13nModel:(0,n(1471).getI13nModel)("sort-btn",e.getI13nOverride(o)),onClick:e.handleFilterClick},e.getSortLabel(o),u.default.createElement(n(31).Icon,{asset:g.default,className:"Mstart(5px) Mend(13px) Trsdu(.5s)",color:r?"#5601ec":"#26282a",width:10,height:10,style:{verticalAlign:"middle"}})),e.renderSortOptions(),e.renderSelectedTags(),e.renderMyCommentsButton())}}]),t}(n(1).PureComponent);y.contextTypes={configStoreState:l.default.object.isRequired,context:l.default.string,contextDisplayText:l.default.string,contextUrl:l.default.string,executeAction:l.default.func,handleUserMessages:l.default.func,instanceId:l.default.string,intl:l.default.object,isUserMessageHistory:l.default.bool,tags:l.default.string,tagsAnd:l.default.string,tagsOr:l.default.string,userMessageHistoryGuid:l.default.string},y.defaultProps={arrangement:[],count:0,sortBy:"popular"},t.default=(0,f.default)(y),e.exports=t.default},3293:function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function i(e,t){var n=t.instanceId||t.id,a=e.getStore(N.default).getCommentsState(n),s=e.getStore(N.default).getUserCommentsState(),o=e.getStore(L.default),r=e.getStore(P.default),i=e.getStore(w.default).getState(),l=e.getStore(A.default).getState(),u=a.get("deepLink"),c=e.getStore(R.default).getSentiments(n),d=(0,g.default)(t,["componentConfig","ui"],{}),f=a.get("disabled"),p=a.get("sortBy"),m="",h=0,v="",x=a.get("messageList"),b=l.topReplySort&&"popular"===p?"popular":"createdAt",S=a.get("showLoadNext");return(t.context||(0,g.default)(e,["session","query","context"],""))===a.get("context")&&(m=a.get("context"),h=a.get("count"),v=a.get("contextDisplayText")),u&&u.get("replyId")&&(x=y.default.List([u.get("message")]),b="createdAt",S=!1),{commentingState:i.commenting,configStoreState:l,context:m,contextDisplayText:v,contextUrl:a.get("contextUrl"),count:h,deepLink:u?u.toJS():null,disabled:f,expanded:!f&&a.get("expanded",(0,g.default)(d,["expanded"],!0)),guid:o.getGUID(),messages:x,namespace:t.namespace||a.get("namespace")||l.namespace,newMessagesCount:a.get("newMessagesCount"),nextIndex:a.get("nextIndex"),instanceId:n,relatedTags:a.get("relatedTags"),replySortBy:b,selectedTags:a.get("selectedTags"),selectedTagsCount:a.get("selectedTagsCount"),sentiments:c,showLoadNext:S,sortBy:p,tags:a.get("tags"),tagsAnd:a.get("tagsAnd"),tagsOr:a.get("tagsOr"),userActivity:a.get("userActivity"),userComments:s,userProfile:r.getProfile()}}Object.defineProperty(t,"__esModule",{value:!0});var l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},u=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),c=a(n(0)),d=a(n(1)),f=a(n(544)),p=a(n(2314)),m=a(n(1597)),h=a(n(5)),g=a(n(2)),y=a(n(11)),v=a(n(525)),x=a(n(37)),b=a(n(130)),S=a(n(1886)),C=a(n(1312)),_=a(n(534)),E=a(n(588)),M=a(n(3294)),k=a(n(2539)),T=a(n(2540)),I=a(n(3295)),O=a(n(509)),N=a(n(307)),w=a(n(2315)),A=a(n(117)),P=a(n(305)),R=a(n(2765)),L=a(n(82)),j=a(n(3296)),F=a(n(2541)),B=a(n(2772)),U=a(n(1304)),D=a(n(2776)),H=a(n(3315)),V=a(n(3317)),z="undefined"!=typeof document?document:null,G="undefined"!=typeof window?window:null,W=function(e){function t(e){s(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),a=n;return(0,m.default)(a,["handleContainerScroll","handleClick","handleMessage","handleOverlay","handleRefresh","handleRemoveUserComments","handleResize","handleShowMessages","handleToggleComments","handleUserMessages","handleWindowScroll"]),a.state={loadingNextComments:!1,overlay:!1,pollingEnabled:!1,userHistoryTop:"0px"},a.hasEnoughHeight=!0,a.isDwellActive=!1,a.isFullScreen=(0,g.default)(e,["componentConfig","ui","isFullScreen"]),a.isIframe=G&&G!==G.parent,a.isIframeInViewport=a.isIframe&&a.isFullScreen,n}return r(t,e),u(t,[{key:"getChildContext",value:function(){var e=this.props;return{componentConfig:e.componentConfig,configStoreState:e.configStoreState,context:e.context,contextUrl:e.contextUrl,contextDisplayText:e.contextDisplayText,guid:e.guid,instanceId:e.instanceId,namespace:e.namespace,tags:e.tags,tagsAnd:e.tagsAnd,tagsOr:e.tagsOr,handleUserMessages:this.handleUserMessages,handleOverlay:this.handleOverlay,handleResize:this.handleResize}}},{key:"componentWillMount",value:function(){this.loadEventFired=!1}},{key:"componentDidMount",value:function(){var e=this,t=e.context,a=e.props,s=(0,n(10).findDOMNode)(e.refs.canvass),o=a.componentConfig.ui||{};if(e.setupRapidInstance(),e.setupPolling(a.configStoreState.pollingInterval),e.scrollHandler=(0,x.default)("scroll",e.handleWindowScroll,{enableScrollInfo:!0}),s&&o.scrollPagination&&(e.scrollContainer=e.isFullScreen?s.querySelector("#comments-fullscreen"):G)&&e.scrollContainer.addEventListener("scroll",(0,b.default)(e.handleContainerScroll,50)),a.deepLink&&t.renderTarget.isActive()){if(s){var r=a.componentConfig.FIXED_UH_HEIGHT||0,i=z.documentElement;(0,f.default)((i&&i.scrollTop||z.body.scrollTop||0)+s.getBoundingClientRect().top-r-50)}e.handleShowMessages("showExpanded")}G.addEventListener("message",e.handleMessage),e.handleResize(),e.setPollingState(a),e.setDwellState(!!a.expandForRoute||e.isFullScreen)}},{key:"componentWillUnmount",value:function(){var e=this;e.scrollHandler&&e.scrollHandler.unsubscribe(),e.scrollContainer&&e.scrollContainer.removeEventListener("scroll",e.handleContainerScroll),G.removeEventListener("message",e.handleMessage),e.setDwellState(!1),e.setupPolling(0),e.destroyRapidInstance(),e.context.getStore(N.default).resetUserComments()}},{key:"componentDidUpdate",value:function(e,t){var n=this.props;e.expanded===n.expanded&&e.messages===n.messages||this.handleResize(),e.expanded!==n.expanded&&this.setDwellState(n.expanded)}},{key:"setupRapidInstance",value:function(){var e=this;if(e.isFullScreen){var t=n(64).RapidManager&&n(64).RapidManager.getRapidInstance();if(t){if(t.addModuleAPV){var a=G.rapidListeners||{};G.rapidListeners=a,e.destroyRapidInstance(),a.canvassAPV=t.addModuleAPV("comments-fullscreen")}t.beaconAPV&&t.beaconAPV()}}}},{key:"destroyRapidInstance",value:function(){var e=(0,g.default)(G.rapidListeners,["canvassAPV"]);e&&"function"==typeof e.destroy&&(e.destroy(),delete G.rapidListeners.canvassAPV)}},{key:"handleContainerScroll",value:function(){var e=this,t=e.props,a=e.scrollContainer;if(t.expanded&&t.showLoadNext&&!e.state.loadingNextComments){var s=e.refs.shownextbutton,o=(0,n(10).findDOMNode)(s);if(o){var r=a.innerHeight||a.clientHeight;o.getBoundingClientRect().top<r+n(517).SCROLL_BUFFER&&(e.handleShowMessages("showNext"),(0,n(1471).fireRapidClick)(Object.assign({},s.getI13nNode().getMergedModel(),{elmt:"scroll"})))}}}},{key:"handleWindowScroll",value:function(e,t){this.setPollingState(this.props,t)}},{key:"handleClick",value:function(){var e=this;e.setDwellState(e.props.expanded)}},{key:"handleClickOutside",value:function(){var e=this;!e.isIframe&&e.isDwellActive&&e.setDwellState(!1)}},{key:"setDwellState",value:function(e){var t=this;t.context.renderTarget.isActive()&&e!==t.isDwellActive&&!t.isIframe&&(t.isDwellActive=e,t.context.executeAction(I.default,{context:t.props.context,pct:e?"comments":""}))}},{key:"getUserHistoryTop",value:function(e){var t=0,a=e.userComments.get("guid"),s=(0,n(10).findDOMNode)(this.refs.canvass);if(!a||!s||!s.getBoundingClientRect)return"0px";if(this.isFullScreen)return Math.max(Math.floor((G.innerHeight-n(517).USER_HISTORY_HEIGHT)/2)-4,n(517).COMMUNITY_BAR_HEIGHT)+"px";var o=s.getBoundingClientRect(),r=e.componentConfig.FIXED_UH_HEIGHT||0,i=Math.max(r,o.top),l=G.innerHeight-i;this.hasEnoughHeight=o.height>=n(517).USER_HISTORY_HEIGHT;var u=o.top<=0?Math.abs(o.top)+r:o.top<=r?r-o.top:0;if(l<n(517).USER_HISTORY_HEIGHT)t=u;else if(this.hasEnoughHeight){t=G.parent!==G&&this.userHistoryClickPos?Math.max(r,this.userHistoryClickPos-n(517).USER_HISTORY_HEIGHT/3):u+parseInt(l/2-n(517).USER_HISTORY_HEIGHT/2,10);var c=t+n(517).USER_HISTORY_HEIGHT;c>o.height&&(t=o.height-n(517).USER_HISTORY_HEIGHT-100)}else t=0;return t+5+"px"}},{key:"componentWillReceiveProps",value:function(e){var t=this,a=e.context,s=e.tags,o=e.count;if(!t.loadEventFired&&(s||a)){var r=t.context.i13n.getI13nNode().getMergedModel();r.cat=s||"",r.context=a,r.slk="canvass-load",r.t1="a3",r.t2="results",r.t3=o,(0,n(1471).fireRapidEvent)("secvw",r),this.loadEventFired=!0}t.setState({loadingNextComments:!1,userHistoryTop:e.userComments?this.getUserHistoryTop(e):"0px"});var i=e.configStoreState.pollingInterval;t.props.configStoreState.pollingInterval!==i&&(t.setupPolling(i),t.setPollingState(e)),t.props.expanded!==e.expanded&&t.setPollingState(e)}},{key:"setupPolling",value:function(e){var t=this,n=t.timer;n&&(clearInterval(n),t.timer=null),e>0&&!t.props.disabled&&(t.timer=setInterval(t.handleRefresh,1e3*e))}},{key:"setPollingState",value:function(e,t){var a=this,s=(0,n(10).findDOMNode)(a.refs.canvass);if(!s||!e.expanded||e.isReadOnly||void 0===G||!a.context.renderTarget.isActive())return void a.setState({pollingEnabled:!1});var o=!1;if(a.isIframe)o=a.isIframeInViewport;else{var r=t&&t.resize&&t.resize.height||G.innerHeight,i=s.getBoundingClientRect();o=!(i.top>r+20||i.bottom<-20)}e.configStoreState.pollingInterval>0&&a.state.pollingEnabled!==o&&(a.setState({pollingEnabled:o}),o&&(t||a.isIframe)&&a.handleRefresh()),!o&&a.isDwellActive&&a.setDwellState(!1)}},{key:"handleMessage",value:function(e){var t=this;if(e&&e.data&&e.source!==G&&t.refs.canvass){var a=e.data,s=t.props.expanded,o=t.refs.canvass.getI13nNode().getMergedModel();s||"canvass:expand"!==a?s&&"canvass:collapse"===a?(t.handleShowMessages("showCollapsed"),(0,n(1471).fireRapidClick)(Object.assign({},o,(0,n(1471).getI13nModel)("comments-close")))):"canvass:enterViewport"===a?(t.isIframeInViewport=!0,t.setPollingState(t.props)):"canvass:exitViewport"===a&&(t.isIframeInViewport=!1,t.setPollingState(t.props)):(t.handleShowMessages("showExpanded"),(0,n(1471).fireRapidClick)(Object.assign({},o,(0,n(1471).getI13nModel)("comments-open"))))}}},{key:"handleOverlay",value:function(e){this.setState({overlay:e})}},{key:"handleRefresh",value:function(){var e=this.props,t=e.instanceId,a=e.namespace,s=e.selectedTags,o=z&&z.visibilityState||"visible";if(this.state.pollingEnabled&&"visible"===o&&(0,n(10).findDOMNode)(this.refs.canvass)){var r=(0,g.default)(e,["componentConfig","ui"])||{},i=r.sortTabs||{},l=i.polling||i.arrangement||[],u=void 0;-1!==l.indexOf(e.sortBy)?u=E.default:r.presence&&r.presence.readingUsersCount&&(u=M.default),u&&this.context.executeAction(u,{context:e.context,instanceId:t,namespace:a,refresh:!0,selectedTags:s&&s.size?s.join(","):"",tagsAnd:e.tagsAnd,tagsOr:e.tagsOr})}}},{key:"handleResize",value:function(){var e=this.props;e.handleResize&&this.context.executeAction(T.default,{context:e.context,count:e.count,isExpanded:e.expanded})}},{key:"handleShowMessages",value:function(e){var t=this.props,n=t.selectedTags,a=_.default,s={context:t.context,contextUrl:t.contextUrl,contextDisplayText:t.contextDisplayText,instanceId:t.instanceId,namespace:t.namespace,selectedTags:n&&n.size?n.join(","):"",sortBy:t.sortBy,tagsAnd:t.tagsAnd,tagsOr:t.tagsOr};"showNext"===e?(this.setState({loadingNextComments:!0}),s.nextIndex=t.nextIndex,s.showNextClicked=!0):"showNew"===e?(s.showNewClicked=!0,s.sortBy="createdAt"):"showExpanded"===e?(s.expanded=!0,a=S.default):"showCollapsed"!==e||(0,g.default)(t,["componentConfig","ui","isFullScreen"])||(s.expanded=!1,a=S.default),this.context.executeAction(a,s)}},{key:"handleUserMessages",value:function(e,t,n,a){this.context.executeAction(k.default,{guid:e,image:t,name:n,sortBy:"createdAt",instanceId:this.props.instanceId}),a&&(this.userHistoryClickPos=a.clientY,this.userHistoryClickTarget=a.currentTarget)}},{key:"handleRemoveUserComments",value:function(){var e=this;e.handleOverlay(!1),e.context.getStore(N.default).resetUserComments(),e.userHistoryClickTarget&&(e.userHistoryClickTarget.focus(),e.userHistoryClickTarget=null,e.userHistoryClickPos=0)}},{key:"handleToggleComments",value:function(){this.handleShowMessages(this.props.expanded?"showCollapsed":"showExpanded")}},{key:"renderShowNewMessagesButton",value:function(){var e=this,t=this.props,a=t.newMessagesCount,s=this.state.loadingNextComments;if(a&&t.expanded)return d.default.createElement(n(1471).I13nButton,{ref:"shownewbutton",i13nModel:(0,n(1471).getI13nModel)("comments-showNew"),onClick:function(){return e.handleShowMessages("showNew")},className:p.default.get("btn btn-secondary btn-spacing btn-sm-fullwidth","D(b) Mx(a) Pos(r) Mb(0)")},!s&&a?"("+a+") ":"",d.default.createElement(n(35).FormattedMessage,{id:s?"CANVASS_LOADING_MORE_COMMENTS":"CANVASS_SHOW_NEW_COMMENTS"}))}},{key:"renderShowNextButton",value:function(){var e=this,t=this.props;if(t.showLoadNext&&t.expanded)return d.default.createElement(n(1471).I13nButton,{ref:"shownextbutton",i13nModel:(0,n(1471).getI13nModel)("comments-showMore"),onClick:function(){return e.handleShowMessages("showNext")},className:p.default.get("btn btn-secondary btn-spacing btn-sm-fullwidth","showNext D(b) Mx(a) Pos(r)")},d.default.createElement(n(35).FormattedMessage,{id:this.state.loadingNextComments?"CANVASS_LOADING_MORE_COMMENTS":"CANVASS_SHOW_MORE_COMMENTS"}))}},{key:"renderActivityIndicator",value:function(){var e=this.props,t=(0,g.default)(e,["componentConfig","ui","presence","enabled"]);if(e.expanded&&t){var n=e.context,a=(0,g.default)(e,["commentingState",n],!1);return d.default.createElement(j.default,{key:n,commenting:a,userActivity:e.userActivity})}}},{key:"renderUserCount",value:function(){var e=this.props,t=e.deepLink,n=e.userActivity;if((0,g.default)(e,["componentConfig","ui","presence","readingUsersCount"])&&e.count&&e.expanded&&n)return d.default.createElement(V.default,{className:t&&t.replyId?"Mt(20px) D(n)--maw350":"Mt(5px)",count:n.get("readingUsersCount",0)})}},{key:"renderUserComments",value:function(){var e=this.props,t=e.userComments,n=e.instanceId;if(t.get("guid")&&t.get("instanceId")===n)return d.default.createElement(U.default,{transitionName:"action",transitionAppear:!0,transitionAppearTimeout:300,transitionEnterTimeout:300,transitionLeaveTimeout:300},d.default.createElement(H.default,{handleRemoveUserComments:this.handleRemoveUserComments,isFullScreen:this.isFullScreen,key:"userComments-"+t.get("guid"),top:this.state.userHistoryTop,userComments:t}))}},{key:"renderDisclaimer",value:function(e){var t=e.text;if(e.enable&&t&&t.length)return d.default.createElement("div",{className:"canvass-disclaimer Bd Bdc(#d8dade) P(10px) Mt(10px)"},d.default.createElement(n(31).Icon,{className:"Mend(6px) Fl(start)",color:"#f00",height:20,name:"attention",width:20}),t.map(function(e,t){return d.default.createElement("p",{className:"Mb(6px) Fz(14px) Fw(200)",dangerouslySetInnerHTML:{__html:e},key:t})}))}},{key:"render",value:function(){var e=this,t=e.isFullScreen,a=e.props,s=a.componentConfig,o=a.configStoreState,r=a.context,i=a.contextDisplayText,u=a.contextUrl,c=a.count,f=a.deepLink,p=a.selectedTags,m=a.sortBy,y=e.state.overlay,v=s.isReadOnly,x=!(!f||!f.replyId);if(a.disabled||v&&0===c||!e.context.renderTarget.isActive())return null;var b=a.messages?a.messages.toJS():[],S=s.ui||{},C=void 0,_=void 0,E=void 0,M=void 0,k=void 0;c>0&&(a.expanded||f)&&(f&&f.message&&!x&&(E=d.default.createElement(F.default,{className:"Mstart(-12px) My(15px)",deepLink:f,isReadOnly:v,itemClassName:"P(12px)",list:[f.message],parentContextDisplayText:i,parentContextUrl:u,replySortBy:a.replySortBy,sortBy:m})),x?C=d.default.createElement(n(1471).I13nButton,{className:"C($c-fuji-blue-1-a) Fz(16px) Fw(b) Mt(16px)",onClick:e.handleShowMessages},d.default.createElement(n(31).Icon,{className:"Fl(start) Mstart(-15px) Mend(2px)",color:"#188fff",height:22,name:"caret-left",style:{strokeWidth:1},width:22}),d.default.createElement(n(35).FormattedMessage,{id:"CANVASS_VIEW_ALL_COMMENTS",values:{count:c}})):!v&&b.length>0&&(C=d.default.createElement(D.default,l({},S.sortTabs,{count:c,currentUserGuid:a.guid,currentUserProfile:a.userProfile,key:"sorting-tabs",ref:"sortingtabs",selectedTags:p,selectedTagsCount:a.selectedTagsCount,sortBy:m}))),_=d.default.createElement(F.default,{className:v?"Mstart(-8px)":"Mstart(-12px) Pt(5px)",isReadOnly:v,itemClassName:v?"Mt(10px) P(8px)":"Mt(5px) P(12px)",list:b,ref:"commentlist",parentContextDisplayText:i,parentContextUrl:u,replySortBy:a.replySortBy,sortBy:m}));var T=void 0;x||(T=d.default.createElement(B.default,{commentsExpanded:a.expanded,count:c,enableTitleClick:!S.expanded||S.enableCommentsToggle,isFullScreen:t,isReadOnly:v,onTitleClick:this.handleToggleComments,ref:"commentform",relatedTags:a.relatedTags,selectedTags:a.selectedTags,sentiments:a.sentiments})),r&&!v&&(M=e.renderShowNewMessagesButton(),k=e.renderShowNextButton());var I={cat:a.tags||"",cnv_bkt:o.rankingProfile||o.scoreAlgo,g:r,tags:p.join(",")},O=(0,g.default)(S,["userLabels","enable"]);return d.default.createElement(n(21).I13nDiv,{"aria-label":e.context.intl.formatMessage({id:"CANVASS_COMMENTS"}),className:(0,h.default)(a.className,S.containerExtraClasses),i13nModel:I,id:a.instanceId,onClick:e.handleClick,ref:"canvass",tabIndex:"-1"},t?T:null,d.default.createElement("div",{id:t?"comments-fullscreen":void 0,className:(0,h.default)("comments-body",{"Pos(f) T(0) B(0) Start(0) End(0) Px(20px) Z(1)":t,"Py(70px)":t&&!O,"Pt(70px) Pb(120px)":t&&O,"Ov(s) Ovs(touch)":t&&!y,"Ov(h)":t&&y})},y?d.default.createElement("div",{className:"StretchedBox Bgc(#fff) Op(0.7) Z(2)"}):null,t?null:T,e.renderDisclaimer(S.disclaimer),e.renderUserComments(),E,e.renderUserCount(),C,e.renderActivityIndicator(),M,_,k))}}]),t}(n(1).PureComponent);W.defaultProps={className:"tdv2-applet-canvass Lh(1.55em) M(a) smartphone_Px(10px) Pb(25px) Pos(r) O(n)",configStoreState:{},expanded:!0,handleResize:!0},W.contextTypes={executeAction:c.default.func,getStore:c.default.func,i13n:c.default.object,intl:c.default.object,renderTarget:c.default.object.isRequired,session:c.default.object},W.childContextTypes={componentConfig:c.default.object.isRequired,configStoreState:c.default.object.isRequired,context:c.default.string,contextDisplayText:c.default.string,contextUrl:c.default.string,guid:c.default.string,handleOverlay:c.default.func,handleResize:c.default.func,handleUserMessages:c.default.func,instanceId:c.default.string,namespace:c.default.string,session:c.default.object,tags:c.default.string,tagsAnd:c.default.string,tagsOr:c.default.string};var $=(0,v.default)(W);$.initializeAction=C.default,$.componentConfig={name:"componentComments"},t.default=(0,O.default)($,[N.default,w.default,A.default,P.default,R.default,L.default],i,{session:c.default.object.isRequired}),e.exports=t.default},3294:function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function s(e,t,n){var a=t.instanceId,s=e.getStore(r.default).getState();if(!a||!s.oauthConsumerSecret||!s.oauthConsumerKey)return n("Required fields missing",null);var i=e.getStore(o.default).getCommentsState(a),l={context:t.context||"YahooGlobal",lang:s.lang,region:s.region,namespace:t.namespace||i.get("namespace")||s.namespace,oauthConsumerKey:s.oauthConsumerKey,oauthConsumerSecret:s.oauthConsumerSecret};e.service.read("canvass.getPresence_ns",l,{},function(t,s){if(t||!s)return e.dispatch("CANVASS_PRESENCE_FAILURE",{instanceId:a}),n&&n(t,null);e.dispatch("CANVASS_PRESENCE_SUCCESS",{instanceId:a,userActivity:s}),n&&n()})}Object.defineProperty(t,"__esModule",{value:!0});var o=a(n(307)),r=a(n(117));s.displayName="loadUserActivity",t.default=s,e.exports=t.default},3295:function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function s(e,t,a){var s=e.getStore(r.default),i=s&&s.getI13nConfig()||{},l=(0,o.default)(i.rapid,["dwell_on"]),u=t.pct||(0,o.default)(i.rapid,["keys","pct"]),c=t.context,d=n(64).RapidManager&&n(64).RapidManager.getRapidInstance();d&&l?d.beaconClick("rapidDwell","",0,{g:c},"",function(){d.setRapidAttribute({keys:{pct:u}}),d.beaconClick("rapidDwell","",0,{g:c},"",null,{dwell:"start"}),a&&a()},{dwell:"stop"}):a&&a()}Object.defineProperty(t,"__esModule",{value:!0}),t.default=s;var o=a(n(2)),r=a(n(70));e.exports=t.default},3296:function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),l=a(n(0)),u=a(n(1)),c=a(n(2316)),d=a(n(1304)),f=function(e){function t(e){s(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={typingUsersCount:e.userActivity&&e.userActivity.get("typingUsersCount")||0},n}return r(t,e),i(t,[{key:"componentDidMount",value:function(){this.state.typingUsersCount>0&&this.context.handleResize()}},{key:"componentDidUpdate",value:function(e,t){var n=t.typingUsersCount,a=this.state.typingUsersCount;n!==a&&(n<=0||a<=0)&&this.context.handleResize()}},{key:"componentWillReceiveProps",value:function(e){var t=e.userActivity&&e.userActivity.get("typingUsersCount")||0,n=this.state.typingUsersCount;this.props.commenting!==e.commenting&&(t=e.commenting?n+1:n-1),this.setState({typingUsersCount:t})}},{key:"render",value:function(){var e=this.state.typingUsersCount;return e<=0?null:u.default.createElement(c.default,null,u.default.createElement(d.default,{transitionName:"action",transitionAppear:!0,transitionAppearTimeout:0,transitionEnterTimeout:0,transitionLeaveTimeout:300},u.default.createElement("div",{className:"Mt(24px) Pb(12px) H(0) BdT Bdc($c-fuji-grey-c) Ta(c)"},u.default.createElement("span",{className:"Bgc($c-fuji-grey-b) H(24px) Px(10px) Py(0) Pos(r) T(-14px) Bd Bdc($c-fuji-grey-c) Bdrs(5px) D(ib)"},u.default.createElement("span",{className:"C($c-fuji-grey-l) Fz(12px) Fw(500) D(ib) Lh(20px) Va(tt)"},this.context.intl.formatMessage({id:"CANVASS_USERS_COMMENTING"},{count:e})),u.default.createElement("img",{alt:"",className:"Va(m) Mstart(5px)",src:"https://s.yimg.com/dh/ap/default/161130/loading_dots.gif",width:"30",height:"10"})))))}}]),t}(n(1).PureComponent);f.contextTypes={handleResize:l.default.func.isRequired,intl:l.default.object.isRequired},f.defaultProps={commenting:!1},t.default=f,e.exports=t.default},3297:function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},l=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),u=a(n(0)),c=a(n(1)),d=a(n(2043)),f=a(n(5)),p=a(n(2)),m=a(n(1597)),h=a(n(3298)),g=a(n(3299)),y=a(n(2769)),v=a(n(2316)),x=a(n(1304)),b=a(n(2771)),S=a(n(3302)),C=a(n(3303)),_=a(n(2775)),E=(0,n(21).createI13nNode)("li",{isLeafNode:!0}),M=5,k=new RegExp("(\r\n|\r|\n)|"+h.default.URLPATTERN+"|"+h.default.PSEUDOURLPATTERN,"gim"),T=/(\r\n|\r|\n)/g,I=/(\r\n|\r|\n){3,}/g,O=function(e){function t(e,n){s(this,t);var a=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));(0,m.default)(a,["handleFeedbackMessage","handleImageLoad","handleMessageClick"]);var r=n.guid,i=e.data.meta,l=void 0===i?{}:i,u=r&&r===(0,p.default)(l,["author","guid"])&&Date.now()/1e3-l.createdAt<=M;return a.state={actionType:null,animClass:u?"Bgc(#fff8e4)":"",imageLoaded:!1,isNew:u,showFeedbackMessage:!1,visible:!1},a}return r(t,e),l(t,[{key:"getChildContext",value:function(){var e=this.props;return{contextId:e.contextId,cpos:e.cpos,pos:e.pos}}},{key:"componentDidMount",value:function(){this.setState({animClass:""})}},{key:"componentWillUnmount",value:function(){clearTimeout(this._timer)}},{key:"shouldComponentUpdate",value:function(e,t){return!(0,n(122).shallowEqual)(this.state,t)||!(0,n(122).shallowEqual)(this.props.data,e.data,["vote","contextId","messageId","replyId"])}},{key:"getI13nModel",value:function(){var e=this.props,t=e.cpos,n=e.data,a=e.pos,s=n.replyId,o={elm:"cmmt_seen",msg_id:s||n.messageId,slk:"seen",cpos:t,pos:null!==a?a:"",reply_lv:s?1:0};return this.context.isUserMessageHistory&&(o.g=this.props.contextId),o}},{key:"renderContextInfo",value:function(){var e=this.context,t=this.props,a=(0,p.default)(t.data,["meta","contextInfo"])||{},s=a.displayText||"",o=a.url||"",r="context-info My(8px) Fz(12px) Fw(b) Lh(14px)";if((e.isUserMessageHistory||e.context!==t.contextId)&&null===t.pos&&s)return o?c.default.createElement(n(1471).I13nAnchor,{className:r+" D(ib) Td(n) C($c-fuji-blue-1-a)",href:o,i13nModel:(0,n(1471).getI13nModel)("context-link"),rel:"noopener noreferrer",target:"_blank"},s):c.default.createElement("div",{className:r+" C($c-fuji-grey-l)"},s)}},{key:"parseMessageForLinks",value:function(){var e=this.props,t=e.data,a=e.isReadOnly,s=t.details.userText;if(s){var o=s.replace(I,"\n\n"),r=void 0,i=[],l="",u={index:0,0:""};for(k.lastIndex=0;null!==(r=k.exec(o));)l=o.slice(u.index+u[0].length,r.index),l.length&&i.push(l),i.push(r[0].indexOf(".")>0?c.default.createElement(n(1471).I13nAnchor,{className:"C($c-fuji-blue-1-a) Td(n)",href:-1===r[0].indexOf("://")?"http://"+r[0].trim():r[0],i13nModel:(0,n(1471).getI13nModel)("link"),key:i.length,rel:"noopener noreferrer nofollow",target:"_blank"},r[0]):c.default.createElement("br",{key:i.length})),u=r;i.push(i.length?o.slice(u.index+u[0].length):o);var d=(0,f.default)("C($c-fuji-grey-l) Mb(2px) Fz(14px) Lh(20px) Pend(8px)",{"LineClamp(3,66px)":a});return c.default.createElement("div",{className:d},i)}}},{key:"renderVideo",value:function(e){if(e&&0!==e.length){var t=this.props,n=e[0],a=n.video,s=n.title,o=n.description;return c.default.createElement(b.default,{enhancedLink:{url:a?a.url:"",title:s,description:o,image:{url:a.coverImage?a.coverImage.url:""}},fromStream:!0,isReply:null!==t.pos,messageId:t.data.messageId,isUserMessageHistory:this.context.isUserMessageHistory})}}},{key:"handleImageLoad",value:function(){this.setState({imageLoaded:!0})}},{key:"renderImage",value:function(e){if(e&&0!==e.length){var t=(0,p.default)(e,[0,"image","resolutions"],[]),a=(0,p.default)(e,[0,"attribution","name"],"");a=a?(0,n(122).trimDescription)(a,30):"";var s=void 0;if(t&&0!==t.length){s=t[0];for(var o=t.length-1;o>=0;o--)if(t[o].width<=375){s=t[o];break}}else s=(0,p.default)(e,[0,"image"]);if(s){return c.default.createElement("div",{className:"Pos(r) D(ib) Lh(12px)"},c.default.createElement(n(81).Img,{key:s.url,className:"W(a) Mah(320px) My(3px) H(a) Maw(100%)",url:s.url,onLoadCallback:this.handleImageLoad,forceLoad:!0,alt:"Image"+a,height:s.height,width:s.width}),(this.state.imageLoaded||this.context.isUserMessageHistory)&&a?c.default.createElement("div",{className:"W(100%) Ta(end) Op(0.6) Bg(gradient) Fz(9px) Fw(b) C($c-fuji-grey-c) Pos(a) End(0) B(3px) Lh(8px) Py(4px)"},c.default.createElement("div",{className:"D(ib) Op(1)"},c.default.createElement(n(35).FormattedMessage,{id:"CANVASS_ATTRIBUTION",values:{author:a,source:c.default.createElement("img",{className:"W(a) Mend(5px) Mstart(2px) Va(bl)",src:"https://s.yimg.com/dh/ap/default/160620/tumblr-logo-transparent-1x.png"})}}))):void 0)}}}},{key:"renderSmartLink",value:function(e){if(e&&0!==e.length){var t=this.props,n=e[0],a=n.url,s=n.title,o=n.description,r=n.coverImages;return c.default.createElement(b.default,{enhancedLink:{url:a,title:s,description:o,image:{url:r&&r[0].url}},fromStream:!0,isReply:null!==t.pos,messageId:t.data.messageId,isUserMessageHistory:this.context.isUserMessageHistory})}}},{key:"shouldEnableSeeMore",value:function(e,t){if(this.props.isReadOnly||!e.enable||!t)return!1;var n=t.userText||"";return n.length>e.maxTextLength||(n.match(T)||[]).length>=e.lines}},{key:"handleMessageClick",value:function(e){if(!e.target.getAttribute("href")&&this.context.isUserMessageHistory){var t=this.props.data,a=(0,p.default)(t,["meta","contextInfo"])||{},s=a.url;if(s){s+=(-1===s.indexOf("?")?"?":"&")+"messageId="+t.messageId,t.replyId&&(s+="&replyId="+t.replyId);window.open(s+"&bcmt=1","_blank").opener=null,(0,n(1471).fireRapidClick)(Object.assign(this.context.i13n.getI13nNode().getMergedModel(),this.getI13nModel(),{elm:"cmmt_body",slk:"deeplink",itc:0}))}}}},{key:"renderMessage",value:function(){var e=this.props,t=e.data,n=e.seeMore,a=void 0===n?{}:n,s=this.context.isUserMessageHistory,o=(0,p.default)(t,["details"],{}),r=s&&!!(0,p.default)(t,["meta","contextInfo","url"]),i=this.parseMessageForLinks(),l=this.shouldEnableSeeMore(a,o),u={isUserMessageHistory:s,lines:a.lines,lineHeight:a.lineHeight};return c.default.createElement("div",{className:"Wow(bw)"+(r?" Cur(p)":""),onClick:this.handleMessageClick},l?c.default.createElement(S.default,u,i):i,this.renderVideo(o.videoMessageDetails)||this.renderSmartLink(o.linkMessageDetails)||this.renderImage(o.imageMessageDetails))}},{key:"renderUserLabels",value:function(){var e=this.context,t=this.props,n=t.data,a=(0,p.default)(n,["userLabels"],[]),s=(0,p.default)(e,["componentConfig","ui","userLabels"],{});if(s.enable&&!(a.length<1)){return c.default.createElement(_.default,i({className:"Py(4px)",userLabels:a},s))}}},{key:"renderActionForm",value:function(){var e=this.context,t=this.props,n=t.data,a=n.meta.author;if(!t.isReadOnly)return c.default.createElement(v.default,null,c.default.createElement(g.default,{creator:a.guid,handleFeedbackMessage:this.handleFeedbackMessage,isReadOnly:t.isReadOnly,isUserMessageHistory:e.isUserMessageHistory,messageId:n.messageId,messageNamespace:t.messageNamespace,nickname:a.nickname,parentContextDisplayText:t.parentContextDisplayText,parentContextUrl:t.parentContextUrl,replyId:n.replyId}))}},{key:"renderSocialControl",value:function(){var e=this.context,t=this.props,n=t.data,a=n.meta.author;if(!t.isReadOnly)return c.default.createElement(C.default,{author:a,instanceId:e.instanceId,isUserMessageHistory:e.isUserMessageHistory,key:"social-"+(n.replyId||n.messageId),messageId:n.messageId,messageNamespace:t.messageNamespace,parentContextDisplayText:t.parentContextDisplayText,parentContextUrl:t.parentContextUrl,parentTags:t.parentTags||[],reactionStats:n.reactionStats,replyCount:n.reactionStats.replyCount,replyId:n.replyId,replySortBy:t.replySortBy,sortBy:t.sortBy,userReportedAbuse:n.abuseReason,vote:(n.vote||"").toLowerCase()})}},{key:"handleFeedbackMessage",value:function(e){this.setFeedbackTimer(),this.setState({showFeedbackMessage:!0,actionType:e,visible:!0})}},{key:"setFeedbackTimer",value:function(){null!==this._timer&&clearTimeout(this._timer),this._timer=setTimeout(function(){this.setState({visible:!1}),this._timer=null}.bind(this),2e3)}},{key:"renderFeedbackMessage",value:function(){if(this.state.visible){var e="delete"===this.state.actionType?"CANVASS_DELETED_MESSAGE":"flag"===this.state.actionType?"CANVASS_FLAGGED_MESSAGE":"CANVASS_MUTED_MESSAGE";return c.default.createElement("div",{className:"Pos(a) Start(0) Bxz(bb) W(100%) Bxsh(boxShadow) Py(6px) Px(8px) Fz(13px) C(#000) Bgc($c-fuji-grey-b)"},c.default.createElement(n(31).Icon,{name:this.state.actionType,className:"Px(8px)",color:"#000",style:{verticalAlign:"middle"},width:21,height:21}),c.default.createElement(n(35).FormattedMessage,{id:e}))}}},{key:"render",value:function(){var e=this.props,t=e.data,n=e.pos,a=this.state,s=a.isNew,o=a.showFeedbackMessage,r=t.messageId,l=t.replyId;if(!t.details)return null;var u=t.meta,f=u.createdAt,p=u.author,m=t.lastActivity&&t.lastActivity.activityAt||0,h=p&&p.image?p.image.url:"",g=this.getI13nModel(),v=d.default.dedupe("comment Pend(2px) "+e.className,this.state.animClass,{"Trsde(3s) Trsdu(.5s)":s&&!o,"Mb(40px)":o,"P(0)! M(0)!":o&&!this.state.visible}),b=d.default.dedupe("Pos(r) Pstart(52px)",{"Pstart(40px)":null!==n}),S=s?x.default:E,C=void 0;s&&(C={component:E,transitionName:"action",transitionAppear:!0,transitionAppearTimeout:500,transitionEnter:!1,transitionLeave:!1});var _="comment"+(l||r);return o?c.default.createElement(x.default,{transitionName:"action",transitionAppear:!0,transitionAppearTimeout:500,transitionEnterTimeout:500,transitionLeaveTimeout:1e3},c.default.createElement("li",{key:"feedback"+this.state.visible,className:v},this.renderFeedbackMessage())):c.default.createElement(S,i({key:_,className:v,i13nModel:g},C),c.default.createElement("div",{className:b},c.default.createElement(y.default,{activityAt:1e3*m,createdAt:1e3*f,creator:p.guid,imageUrl:h,isReadOnly:e.isReadOnly,key:"byline-"+(l||r),messageId:t.messageId,name:p.nickname,pos:n,replyCount:t.reactionStats.replyCount,replyId:t.replyId,sortBy:e.sortBy}),this.renderContextInfo(),this.renderMessage(),this.renderUserLabels(),this.renderActionForm(),this.renderSocialControl()))}}]),t}(n(1).Component);O.contextTypes={componentConfig:u.default.object,configStoreState:u.default.object.isRequired,context:u.default.string,contextDisplayText:u.default.string,contextUrl:u.default.string,executeAction:u.default.func.isRequired,guid:u.default.string,i13n:u.default.object.isRequired,instanceId:u.default.string,intl:u.default.object,isUserMessageHistory:u.default.bool,session:u.default.object,userMessageHistoryGuid:u.default.string},O.childContextTypes={contextId:u.default.string,cpos:u.default.number,pos:u.default.number},O.defaultProps={className:"",contextId:null,cpos:null,data:{},pos:null,sortBy:""},t.default=O,e.exports=t.default},3298:function(e,t){e.exports=Object.freeze({URLPATTERN:"\\b(?:https?|ftp)://[a-z0-9-+&@#/%?=~_|!:,.;]*[a-z0-9-+&@#/%=~_|]",PSEUDOURLPATTERN:"(^|[^/])(www\\.[a-z0-9-+&@#/%?=~_|!:,.;]*[a-z0-9-+&@#/%=~_|])",MENTIONS:"(://|>)?(@([_a-z0-9-]+))",HASHTAGS:"(://[^ <]*|>)?(#([_a-z0-9-]+))"})},3299:function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),l=a(n(0)),u=a(n(1)),c=a(n(2314)),d=a(n(1597)),f=a(n(2)),p=a(n(525)),m=a(n(3300)),h=a(n(3301)),g=a(n(2766)),y=a(n(2767)),v=a(n(2768)),x=function(e){function t(e){s(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return(0,d.default)(n,["closeFlyout","handleAction","handleClickOutside","handleRadioChanged","handleReport","handleToggleFlyout","handleToggleToolTip","openFlyout"]),n.state={selectedAbuseOption:"",flyoutOpened:!1,reportOpened:!1,showTooltip:!1},n}return r(t,e),i(t,[{key:"componentWillReceiveProps",value:function(e){var t=this;t.props.messageId!==e.messageId&&t.setState({flyoutOpened:!1,reportOpened:!1,selectedAbuseOption:"",showTooltip:!1})}},{key:"componentDidUpdate",value:function(e,t){!t.flyoutOpened&&this.state.flyoutOpened&&this.refs.flyout.focus()}},{key:"handleRadioChanged",value:function(e){this.setState({selectedAbuseOption:e.currentTarget.value})}},{key:"handleReport",value:function(){var e=this.context,t=this.props,a=e.intl.formatMessage({id:"CANVASS_FLAG_REASON_ELSE"}),s=this.state.selectedAbuseOption===a?(0,n(10).findDOMNode)(this.refs.reportText).value.trim():this.state.selectedAbuseOption;s?(e.executeAction(g.default,{abuseReason:s,context:e.contextId,instanceId:e.instanceId,isUserMessageHistory:t.isUserMessageHistory,messageId:t.messageId,namespace:t.messageNamespace,pos:e.pos,replyId:t.replyId,voteType:"abuse"}),t.handleFeedbackMessage("flag")):this.setState({reportOpened:!1})}},{key:"handleDelete",value:function(){var e=this.context,t=this.props;e.executeAction(h.default,{context:e.contextId,instanceId:e.instanceId,isUserMessageHistory:t.isUserMessageHistory,messageId:t.messageId,namespace:t.messageNamespace,pos:e.pos,replyId:t.replyId})}},{key:"handleBlockUser",value:function(){var e=this.context,t=this.props;e.executeAction(m.default,{blockedGuid:t.creator,context:e.contextId,instanceId:e.instanceId,isUserMessageHistory:t.isUserMessageHistory,messageId:t.messageId,namespace:t.messageNamespace,pos:e.pos,replyId:t.replyId,userId:e.guid})}},{key:"handleClickOutside",value:function(e){this.closeFlyout()}},{key:"openFlyout",value:function(){this.setState({flyoutOpened:!0})}},{key:"closeFlyout",value:function(){this.setState({flyoutOpened:!1,reportOpened:!1,showTooltip:!1})}},{key:"handleToggleFlyout",value:function(){this.setState({flyoutOpened:!this.state.flyoutOpened,showTooltip:!1})}},{key:"handleToggleToolTip",value:function(){this.setState({showTooltip:!this.state.showTooltip})}},{key:"handleAction",value:function(e){if(!this.context.guid)return void this.setState({showTooltip:!0});var t=this.props,n=void 0!==t.delay?t.delay:2500;"flag"!==e&&(t.handleFeedbackMessage(e),setTimeout(function(){"delete"===e?this.handleDelete():"block"===e&&this.handleBlockUser()}.bind(this),n)),this.setState({flyoutOpened:!1,reportOpened:"flag"===e&&!this.state.reportOpened})}},{key:"renderFlyoutButton",value:function(e){var t="Pos(r) W(100%) H(a) Mih(36px) Z(1) Pend(14px) Bd Bdrs(3px) Bdc($c-fuji-grey-c) Bxsh(boxShadowFlag) Cur(p) Py(6px) Pstart(8px) Fz(13px) C($c-fuji-grey-l) Bgc(#fff) Bgc($c-fuji-grey-b):h flyout-button-"+e,a="D(ib) Ta(start) Wow(bw) Pstart(28px) "+("delete"===e?"W(100px)":"W(125px)"),s=this.context.intl,o=void 0;switch(e){case"delete":o=s.formatMessage({id:"CANVASS_DELETE_MESSAGE"});break;case"flag":o=s.formatMessage({id:"CANVASS_FLAG_MESSAGE"});break;case"block":o=s.formatMessage({id:"CANVASS_MUTE_MESSAGE"},{user:this.props.nickname})}return u.default.createElement(n(1471).I13nButton,{onClick:this.handleAction.bind(this,e),i13nModel:(0,n(1471).getI13nModel)("comment-"+e),role:"menuitem",className:t},u.default.createElement("div",{className:"W(40px) D(ib) Pos(a) T(6px) Start(4px)"},u.default.createElement(n(31).Icon,{name:e,className:"Px(8px)",color:"#000",style:{verticalAlign:"middle"},width:21,height:21})),u.default.createElement("div",{className:a},o))}},{key:"renderFlyout",value:function(){if(!this.state.flyoutOpened)return null;var e=this.props.creator===this.context.guid;return u.default.createElement("div",{tabIndex:"-1",role:"menu",ref:"flyout",className:"flyout O(n) Pos(a) T(0) End(25px) W(190px)"},this.renderFlyoutButton(e?"delete":"flag"),!e&&this.renderFlyoutButton("block"),this.renderTooltip())}},{key:"renderTooltip",value:function(){if(this.state.showTooltip)return u.default.createElement(v.default,{className:"Bxsh(boxShadowFlag) Bxz(bb) W(100%)",handleToggleToolTip:this.handleToggleToolTip,messageId:this.props.messageId,replyId:this.props.replyId})}},{key:"renderFlagOption",value:function(e,t){var n=this.props.replyId||this.props.messageId,a="report-option-"+n+"-"+t,s=this.context.intl.formatMessage({id:e});return u.default.createElement("div",{className:"Mb(10px) flag-opts"},u.default.createElement("input",{id:a,onChange:this.handleRadioChanged,type:"radio",name:"options-"+n,className:"Mend(10px) Va(t)",value:s}),u.default.createElement("label",{htmlFor:a},s))}},{key:"renderOverflowButton",value:function(){var e=this,t=e.context,a=e.state.flyoutOpened?"#188fff":"#878c91",s="desktop"===(0,f.default)(t,["session","dimensions","device"]);return u.default.createElement("span",{className:"Pos(a) End(0) T(-3px)",onMouseEnter:s?e.openFlyout:null,onMouseLeave:s?e.closeFlyout:null},e.renderFlyout(),u.default.createElement(n(1471).I13nButton,{className:"O(n):h O(n):a Bd(n) Px(6px) Py(2px)","aria-expanded":this.state.flyoutOpened?"true":void 0,"aria-haspopup":"true","aria-label":t.intl.formatMessage({id:"CANVASS_SEE_MORE"}),onClick:e.handleToggleFlyout,i13nModel:(0,n(1471).getI13nModel)("options")},u.default.createElement(n(31).Icon,{name:"overflow",color:a,width:16,height:16})))}},{key:"renderReportForm",value:function(){var e=this;if(!e.state.reportOpened)return null;var t=e.context,a=t.intl,s=a.formatMessage({id:"CANVASS_REPORT_REASON"}),o=a.formatMessage({id:"CANVASS_FLAG_REASON_ELSE"}),r={outcm:"close"},i="desktop"===(0,f.default)(t,["session","dimensions","device"]),l=c.default.dedupe("D(n) P(6px) W(100%) H(33px) Fz(13px) Lh(12px) Mb(10px) Pstart(10px)",{"D(b)":e.state.selectedAbuseOption===o,"Fz(16px)":!i}),d="P(6px) W(30%) H(33px) Mend(10px) Mt(5px)";return u.default.createElement("div",{className:"Pos(a) End(35px) T(-3px) P(14px) Fz(13px) Lh(16px) C(#000) Z(2) Bgc(#fff) Bd Bdrs(3px) Bdc($c-fuji-grey-c) Bxsh(boxShadow) report-form-container"},u.default.createElement("div",{className:"Mb(10px) Fw(b)"},u.default.createElement(n(35).FormattedMessage,{id:"CANVASS_REPORT_LABEL"})),u.default.createElement("div",{className:"Row"},e.renderFlagOption("CANVASS_FLAG_REASON_INAPPROPRIATE_POST",1),e.renderFlagOption("CANVASS_FLAG_REASON_DOES_NOT_BELONG_HERE",2),e.renderFlagOption("CANVASS_FLAG_REASON_SPAM",3),e.renderFlagOption("CANVASS_FLAG_REASON_COPYRIGHT_VIOLATION",4),e.renderFlagOption("CANVASS_FLAG_REASON_ELSE",5),u.default.createElement(y.default,{ref:"reportText",rows:5,tabIndex:"1",className:l,placeholder:s}),u.default.createElement(n(1471).I13nButton,{type:"button",className:c.default.get("btn btn-secondary",d),onClick:e.handleAction.bind(e,"flag"),i13nModel:(0,n(1471).getI13nModel)("comment-report-cancel",r)},u.default.createElement(n(35).FormattedMessage,{id:"CANVASS_CANCEL"})),u.default.createElement(n(1471).I13nButton,{type:"button",className:c.default.get("btn btn-primary",d),onClick:e.handleReport,i13nModel:(0,n(1471).getI13nModel)("comment-report-done",Object.assign({slk:e.state.selectedAbuseOption},r))},u.default.createElement(n(35).FormattedMessage,{id:"CANVASS_DONE"}))))}},{key:"render",value:function(){return u.default.createElement("div",null,this.renderOverflowButton(),this.renderReportForm())}}]),t}(n(1).PureComponent);x.contextTypes={componentConfig:l.default.object.isRequired,configStoreState:l.default.object.isRequired,contextId:l.default.string,cpos:l.default.number,getStore:l.default.func.isRequired,guid:l.default.string,instanceId:l.default.string,intl:l.default.object.isRequired,isUserMessageHistory:l.default.bool,executeAction:l.default.func.isRequired,pos:l.default.number,session:l.default.object.isRequired,tags:l.default.string,userMessageHistoryGuid:l.default.string},t.default=(0,p.default)(x),e.exports=t.default},3300:function(e,t,n){"use strict";function a(e,t,n){var a=e.getStore(s.default).getState(),o=Object.assign({lang:a.lang,region:a.region,oauthConsumerKey:a.oauthConsumerKey,oauthConsumerSecret:a.oauthConsumerSecret},t);e.service.create("canvass.blockUser",o,{},function(t,a){if(t||!a||a.error)return e.dispatch("CANVASS_BLOCK_FAILURE",t),n();e.dispatch("CANVASS_BLOCK_SUCCESS",o),n()})}Object.defineProperty(t,"__esModule",{value:!0}),t.default=a;var s=function(e){return e&&e.__esModule?e:{default:e}}(n(117));e.exports=t.default},3301:function(e,t,n){"use strict";function a(e,t,n){var a=t.replyId?"canvass.deleteReply_ns":"canvass.deleteMessage_ns",o=e.getStore(s.default).getState(),r=Object.assign({lang:o.lang,region:o.region,oauthConsumerKey:o.oauthConsumerKey,oauthConsumerSecret:o.oauthConsumerSecret},t);e.service.delete(a,r,{},function(t,a){if(t||!a||a.error)return e.dispatch("CANVASS_DELETE_FAILURE",t),n();e.dispatch("CANVASS_DELETE_SUCCESS",r),n()})}Object.defineProperty(t,"__esModule",{value:!0}),t.default=a;var s=function(e){return e&&e.__esModule?e:{default:e}}(n(117));e.exports=t.default},3302:function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),l=a(n(0)),u=a(n(1)),c=a(n(1597)),d=a(n(1288)),f=a(n(1876)),p=function(e){function t(e){s(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return(0,c.default)(n,["getWrapperStyles","handleClick"]),n.state={expanded:!1},n}return r(t,e),i(t,[{key:"handleClick",value:function(e){e&&e.stopPropagation(),this.setState({expanded:!this.state.expanded})}},{key:"getWrapperStyles",value:function(){return{maxHeight:this.state.expanded?null:this.props.lines*this.props.lineHeight,overflow:"hidden"}}},{key:"componentDidUpdate",value:function(e,t){t.expanded!==this.state.expanded&&this.context.handleResize()}},{key:"render",value:function(){var e=this.props,t=e.children,a=this.state.expanded,s=a?"CANVASS_SEE_LESS":"CANVASS_SEE_MORE",o=(0,n(1471).getI13nModel)("comment-seemore",{sec:e.isUserMessageHistory?"cmmt_his":"cmmts"});return u.default.createElement("div",{className:"canvass-see-more"},u.default.createElement("div",{className:"see-more-wrapper",style:this.getWrapperStyles()},t),u.default.createElement(n(1471).I13nButton,{"aria-hidden":"true",className:"more-button Fz(13px) Fw(b) P(0) Mt(3px) Mb(6px) Bd(0) C($c-fuji-grey-l) O(n):h O(n):a",i13nModel:o,onClick:this.handleClick},u.default.createElement(n(35).FormattedMessage,{id:s,className:"more-button-label"}),u.default.createElement(n(31).Icon,{asset:a?f.default:d.default,className:"Mstart(5px)",color:"#26282a",style:{verticalAlign:"middle"},width:9,height:9})))}}]),t}(n(1).Component);p.contextTypes={handleResize:l.default.func.isRequired},p.defaultProps={lines:3,lineHeight:20},t.default=p,e.exports=t.default},3303:function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function i(e,t){var n=e.getStore(b.default),a=e.getStore(v.default),s=n.getGUID(),o=t.messageId,r=t.instanceId,i=t.isUserMessageHistory,l=t.replyId,u=l?null:a.getCommentsState(r).get("deepLink"),c=[],d={};return l||(c=a.getReplyList(o,r,i).toJS(),d=a.getReplyListState(o,r,i).toJS()),{deepLink:u&&u.get("messageId")===o?u.toJS():void 0,guid:s,isSignedIn:n.isSignedIn(),list:c,replyListState:d}}Object.defineProperty(t,"__esModule",{value:!0});var l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},u=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),c=a(n(0)),d=a(n(1)),f=a(n(1597)),p=a(n(5)),m=a(n(2)),h=a(n(534)),g=a(n(3304)),y=a(n(509)),v=a(n(307)),x=a(n(2315)),b=a(n(82)),S=a(n(2772)),C=a(n(2541)),_=a(n(2770)),E=a(n(3314)),M=a(n(2768)),k=function(e){function t(e,n){s(this,t);var a=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));(0,f.default)(a,["getReplies","handleCloseCommentForm","handleRepliesClick","handleReplyClick","handleReplyFormBlur","handleToggleToolTip","handleViewTopClick"]);var r=!(!e.deepLink||!e.deepLink.replyId),i=(0,m.default)(n.componentConfig,["ui","replyPreview"]);return a.state={loadingNextComments:!1,loadingPrevComments:!1,replyFormInFocus:!1,showReplyForm:r,showReplyList:r||i&&e.list.length>0},a}return r(t,e),u(t,[{key:"getReplies",value:function(e){var t=this,n=t.context,a=t.props,s=a.replyListState.nextIndex,o=!0,r=a.replySortBy;"showNext"===e?t.setState({loadingNextComments:!0}):"showPrev"===e?(r="createdAtDesc",s=a.replyListState.prevIndex,t.setState({loadingPrevComments:!0})):a.replyCount>0&&0===a.list.length?(e="showNext",t.setState({loadingNextComments:!0})):o=!1,o&&n.executeAction(g.default,{action:e,context:n.contextId,count:10,index:s,instanceId:n.instanceId,isUserMessageHistory:n.isUserMessageHistory,messageId:a.messageId,namespace:a.messageNamespace,sortBy:r,tags:n.tags})}},{key:"handleCloseCommentForm",value:function(){this.setState({replyFormInFocus:!1,showReplyForm:!1})}},{key:"handleRepliesClick",value:function(){var e=!this.state.showReplyList;this.getReplies("replies"),this.setState({openedBy:"replies",replyFormInFocus:!1,showReplyForm:e,showReplyList:e})}},{key:"handleReplyClick",value:function(){var e=this.state,t="reply"!==e.openedBy||!e.showReplyForm;t&&this.context.getStore(x.default).setActiveForm(this.props),this.setState({openedBy:"reply",replyFormInFocus:t,showReplyForm:t,showReplyList:!!t&&e.showReplyList})}},{key:"handleReplyFormBlur",value:function(){this.setState({replyFormInFocus:!1})}},{key:"handleToggleToolTip",value:function(){this.setState({showToolTip:!this.state.showToolTip})}},{key:"handleViewTopClick",value:function(){var e=this.context;e.executeAction(h.default,{instanceId:e.instanceId,context:e.contextId,contextUrl:e.contextUrl,contextDisplayText:e.contextDisplayText,selectedTags:"",sortBy:"popular",tagsAnd:e.tagsAnd,tagsOr:e.tagsOr})}},{key:"renderReplyButton",value:function(){var e=this,t=e.state,a=e.props.replyCount,s=e.context.intl,o="reply"!==t.openedBy||!t.showReplyForm,r=!t.showReplyList,i="O(n):h O(n):a P(0) Bd(n) Cur(p) Fz(12px) Fw(500) C($c-fuji-grey-g) D(ib) Mend(20px)";return d.default.createElement("div",{className:"D(ib)"},d.default.createElement(n(1471).I13nButton,{bindClickEvent:o,className:"reply-button "+i,i13nModel:(0,n(1471).getI13nModel)("reply"),key:o?"show-reply":"hide-reply",onClick:this.handleReplyClick},d.default.createElement(n(31).Icon,{asset:_.default,color:"#878c91",height:15,className:"Mend(5px)"}),s.formatMessage({id:"CANVASS_REPLY"})),a>0?d.default.createElement(n(1471).I13nButton,{bindClickEvent:r,className:"replies-button "+i,i13nModel:(0,n(1471).getI13nModel)("replies-show"),key:r?"show-replies":"hide-replies",onClick:this.handleRepliesClick},s.formatMessage({id:"CANVASS_REPLIES"})+" ("+s.formatNumber(a)+")"):void 0)}},{key:"renderLoadingMessage",value:function(e){return d.default.createElement("div",{className:"loading-msg Fz(14px) Fw(b) Lh(n) C($c-fuji-grey-g) D(ib) "+e},this.context.intl.formatMessage({id:"CANVASS_LOADING_MORE_COMMENTS"}))}},{key:"renderShowNextButton",value:function(e){var t=this,a=t.props,s=t.state;if(s.showReplyList)return s.loadingNextComments?t.renderLoadingMessage(e):a.replyListState.showLoadNext?d.default.createElement(n(1471).I13nButton,{i13nModel:(0,n(1471).getI13nModel)("comments-showMore"),onClick:function(){return t.getReplies("showNext")},className:"show-next-button Fz(14px) Fw(b) C($c-fuji-blue-1-a) Bd(0) P(0) Mx(0) "+e},t.context.intl.formatMessage({id:"popular"===a.replySortBy?"CANVASS_SHOW_MORE_REPLIES":"CANVASS_SHOW_OLDER_REPLIES"})):void 0}},{key:"renderShowPrevButton",value:function(e){var t=this;if(this.state.showReplyList)return this.state.loadingPrevComments?this.renderLoadingMessage(e):this.props.replyListState.prevIndex?d.default.createElement(n(1471).I13nButton,{i13nModel:(0,n(1471).getI13nModel)("comments-showMore"),onClick:function(){return t.getReplies("showPrev")},className:"show-prev-button Fz(14px) Fw(b) C($c-fuji-blue-1-a) Bd(0) P(0) Mx(0) "+e},this.context.intl.formatMessage({id:"CANVASS_SHOW_NEWER_REPLIES"})):void 0}},{key:"renderReplyBox",value:function(){var e=this.state;if(e.showReplyForm||e.showReplyList)return d.default.createElement("div",{className:"reply-box"},this.renderCommentForm(),this.renderShowPrevButton("My(10px)"),this.renderCommentList(),this.renderShowNextButton("Mt(10px) Mb(5px) Mstart(40px)"))}},{key:"renderCommentForm",value:function(){if(this.state.showReplyForm){var e=this.props,t=e.author,n=void 0===t?{}:t,a=e.deepLink,s=e.replyId,o=n.nickname;return d.default.createElement(S.default,{cpos:this.context.cpos,deepLink:a,forReply:!0,handleCloseCommentForm:this.handleCloseCommentForm,handleReplyFormBlur:this.handleReplyFormBlur,mentions:s&&o?[{guid:n.guid,nickname:o}]:null,messageId:e.messageId,messageNamespace:e.messageNamespace||null,parentContextDisplayText:e.parentContextDisplayText,parentContextUrl:e.parentContextUrl,parentTags:e.parentTags||[],replyFormInFocus:this.state.replyFormInFocus,replyId:s,value:s&&o?"@"+o+" ":""})}}},{key:"renderCommentList",value:function(){var e=this.props,t=this.state;if(t.showReplyList){var n=(0,p.default)("Mstart(-10px)",{"Pt(10px)":!t.showReplyForm});return d.default.createElement(C.default,{className:n,cpos:this.context.cpos,deepLink:e.deepLink,itemClassName:"Py(10px) Pstart(10px)",key:"commentlist3",list:e.list,parentContextDisplayText:e.parentContextDisplayText,parentContextUrl:e.parentContextUrl})}}},{key:"getThumbProps",value:function(e){var t=this.context,a=this.props,s={contextId:t.contextId,isSignedIn:a.isSignedIn,messageId:a.messageId,messageNamespace:a.messageNamespace,onToggleToolTip:this.handleToggleToolTip,reactionStats:a.reactionStats,replyId:a.replyId,thumbName:e,vote:a.vote,voteType:e},o=e&&n(517).THUMB_PROPS[e];return o&&(s=Object.assign({selectedColor:o.color,selectedIcon:o.icon},s,o),delete s.color),s}},{key:"renderThumbs",value:function(){var e=this,t=e.props,n=(0,m.default)(e.context,["componentConfig","ui","thumbs"],["up"]),a=n.length;return d.default.createElement("div",{className:"D(ib) Pos(r)"},n.map(function(t,n){var s=(0,p.default)("O(n):h O(n):a  Bgc(t) Bdc(t) M(0) P(0) Bd(n)",{"Mend(12px)":n<a-1});return d.default.createElement(E.default,l({},e.getThumbProps(t),{className:s,key:t,showCount:a>1}))}),e.state.showToolTip?d.default.createElement(M.default,{handleToggleToolTip:e.handleToggleToolTip,messageId:t.messageId,replyId:t.replyId}):void 0)}},{key:"componentDidUpdate",value:function(e,t){var n=this.state;(e.list||[]).length===(this.props.list||[]).length&&t.showReplyForm===n.showReplyForm&&t.showReplyList===n.showReplyList||this.context.handleResize()}},{key:"componentWillReceiveProps",value:function(e){var t=this.props,n=this.state,a={};if(e.messageId!==t.messageId||e.replyId!==t.replyId||e.sortBy!==t.sortBy||!e.deepLink&&t.deepLink){a={loadingPrevComments:!1,loadingNextComments:!1,replyFormInFocus:!1,showReplyForm:!1,showReplyList:(0,m.default)(context.componentConfig,["ui","replyPreview"])&&e.list.length>0}}else n.loadingNextComments&&e.replyListState.nextIndex!==t.replyListState.nextIndex&&(a.loadingNextComments=!1),n.loadingPrevComments&&e.replyListState.prevIndex!==t.replyListState.prevIndex&&(a.loadingPrevComments=!1);this.setState(a)}},{key:"render",value:function(){return d.default.createElement("div",{className:this.props.className},this.renderReplyButton(),this.renderThumbs(),this.renderReplyBox())}}]),t}(n(1).PureComponent);k.contextTypes={componentConfig:c.default.object,configStoreState:c.default.object.isRequired,contextId:c.default.string,contextUrl:c.default.string,contextDisplayText:c.default.string,cpos:c.default.number,executeAction:c.default.func.isRequired,getStore:c.default.func.isRequired,handleResize:c.default.func.isRequired,instanceId:c.default.string,intl:c.default.object,isUserMessageHistory:c.default.bool,oauthConsumerKey:c.default.string,oauthConsumerSecret:c.default.string,pos:c.default.number,tags:c.default.string,userMessageHistoryGuid:c.default.string},k.defaultProps={className:"Pos(r) Pt(5px)",list:[],replyListState:{},replySortBy:"createdAt"},t.default=(0,y.default)(k,[b.default,v.default],i),e.exports=t.default},3304:function(e,t,n){"use strict";function a(e,t,n){var a=t.action||"showNext",o=t.isUserMessageHistory,r=t.instanceId,i=t.sortBy,l=e.getStore(s.default).getState(),u=Object.assign({lang:l.lang,region:l.region,namespace:l.namespace,oauthConsumerKey:l.oauthConsumerKey,oauthConsumerSecret:l.oauthConsumerSecret},t);delete u.isUserMessageHistory,delete u.instanceId,e.service.read("canvass.getReplies_ns",u,{},function(t,s){if(t||!s||s.error)return e.dispatch("CANVASS_REPLIES_FAILURE",t),n();var l=s,c=l.length,d={action:a,instanceId:r,isUserMessageHistory:o,messageId:u.messageId,sortBy:i};"showPrev"===a&&(l.reverse(),d.prevIndex=c===u.count?l[0].index:null),d.replyList=l,e.dispatch("CANVASS_REPLIES_SUCCESS",d),n()})}Object.defineProperty(t,"__esModule",{value:!0});var s=function(e){return e&&e.__esModule?e:{default:e}}(n(117));a.displayName="loadReplies",t.default=a,e.exports=t.default},3305:function(e,t,n){"use strict";function a(e,t,n){e.service.read("canvass.smartlinks",t,{},function(a,s){if(a||!s||s.error)return e.dispatch("CANVASS_GET_ENHANCE_URL_FAILURE",a),n();e.dispatch("CANVASS_GET_ENHANCE_URL_SUCCESS",{data:s,messageId:t.messageId}),n()})}Object.defineProperty(t,"__esModule",{value:!0}),t.default=a,e.exports=t.default},3306:function(e,t,n){"use strict";function a(e){return e.mimeType="image/gif",e}function s(e,t,n){var s=e.getStore(o.default).getState();t=Object.assign({lang:s.lang,region:s.region,namespace:s.namespace,oauthConsumerKey:s.oauthConsumerKey,oauthConsumerSecret:s.oauthConsumerSecret},t);var r=t.content,i=t.sticker,l=t.forReply,u=t.enhancedLink,c="TEXT",d={userText:r,contextUrl:t.parentContextUrl||t.contextUrl,contextDisplayText:t.parentContextDisplayText||t.contextDisplayText,details:[],mentions:t.mentions||[],userLabels:t.userLabels||[],visibilityType:"PUBLIC"};if(Array.isArray(i)&&i.length?c="IMAGE":u&&(c="LINK"),"IMAGE"===c){var f=Object.assign({},i[0]);f.animated=!0,f=a(f),f.resolutions=i.map(a),d.details=[{type:"IMAGE",image:f,attribution:{name:t.author||"",source:"tumblr"}}]}else"LINK"===c&&(delete u.messageId,d.details=[u]);d=JSON.stringify(d),e.service.create(l?"canvass.replyMessage_ns":"canvass.postMessage_ns",{context:t.context,messageId:t.messageId,namespace:t.messageNamespace||t.namespace,lang:t.lang,region:t.region,oauthConsumerKey:t.oauthConsumerKey,oauthConsumerSecret:t.oauthConsumerSecret},d,{},function(a,s){if(a||!s||s.error)return e.dispatch("CANVASS_POST_FAILURE",t),n();s.inReplyTo=t.replyId,s.instanceId=t.instanceId,s.isUserMessageHistory=t.isUserMessageHistory,e.dispatch("CANVASS_POST_SUCCESS",s),n()})}Object.defineProperty(t,"__esModule",{value:!0}),t.default=s;var o=function(e){return e&&e.__esModule?e:{default:e}}(n(117));e.exports=t.default},3307:function(e,t,n){"use strict";function a(e,t,n){var a=e.getStore(s.default).getState(),o=JSON.stringify({eventType:t.eventType,messageId:t.messageId}),r={context:t.context,eventType:t.eventType,namespace:t.namespace||a.namespace,lang:a.lang,region:a.region,oauthConsumerKey:a.oauthConsumerKey,oauthConsumerSecret:a.oauthConsumerSecret};e.service.create("canvass.sendHeartbeat_ns",r,o,{},function(t,a){t||!a||a.error?e.dispatch("CANVASS_HEARTBEAT_FAILURE",t):e.dispatch("CANVASS_HEARTBEAT_SUCCESS",r),n()})}Object.defineProperty(t,"__esModule",{value:!0});var s=function(e){return e&&e.__esModule?e:{default:e}}(n(117));a.displayName="sendHeartbeat",t.default=a,e.exports=t.default},3308:function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),l=a(n(0)),u=a(n(1)),c=a(n(2314)),d=a(n(1597)),f=a(n(209)),p=a(n(2)),m=a(n(11)),h=a(n(525)),g=a(n(534)),y=a(n(2774)),v=a(n(93)),x=function(e){function t(e){s(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return(0,d.default)(n,["handleNewSearch","handleRelatedTagsLoadEvent","handleSelectTag"]),n.state={relatedTags:n.props.relatedTags,selectedTags:n.props.selectedTags},n}return r(t,e),i(t,[{key:"handleRelatedTagsLoadEvent",value:function(){var e=this.context,t=this.state,a=t.relatedTags,s=t.selectedTags,o=this.getUpdatedRelatedTags(a,s,e.tagsAnd),r=e.i13n.getI13nNode().getMergedModel();r.cat=s&&s.size?s.join(","):"",r.elm="cmmt_side_convo",r.slk=o?o.size:0,(0,n(1471).fireRapidEvent)("secvw",r)}},{key:"componentWillReceiveProps",value:function(e){this.loadEventFired||(this.loadEventFired=!0,this.handleRelatedTagsLoadEvent()),this.setState({relatedTags:e.relatedTags,enableRelatedTags:e.enableRelatedTags})}},{key:"componentWillMount",value:function(){this.loadEventFired=!1}},{key:"handleClickOutside",value:function(e){this.props.handleRemoveRelatedTags()}},{key:"handleNewSearch",value:function(){var e=this.context;e.executeAction(g.default,{instanceId:e.instanceId,context:e.context,contextUrl:e.contextUrl,contextDisplayText:e.contextDisplayText,tagsAnd:e.tagsAnd,tagsOr:e.tagsOr,selectedTags:this.state.selectedTags.join(",")}),this.props.handleRemoveRelatedTags(),(0,n(1471).fireRapidPageView)("trendingTags")}},{key:"removeSelectedTag",value:function(e){var t=(0,f.default)(this.state.selectedTags);if(t&&t.size){var n=t.filter(function(t){return e!==t});this.setState({selectedTags:n}),this.handleGetNewRelatedTags(n)}}},{key:"handleGetNewRelatedTags",value:function(e){var t=this.context;t.executeAction(y.default,{context:t.context,tagsAnd:(0,n(122).joinFilterTags)(t.tagsAnd,e),tagsOr:t.tagsOr,instanceId:t.instanceId})}},{key:"handleSelectTag",value:function(e){var t=this.state.selectedTags?(0,f.default)(this.state.selectedTags):m.default.List(),n=t.push(e.get("tag"));this.setState({selectedTags:n}),this.handleGetNewRelatedTags(n)}},{key:"renderSelectedTags",value:function(){var e=this.state.selectedTags;if(e&&e.size){var t={pos:e&&e.size||0,outcm:"remove"};return u.default.createElement("div",{className:"Mb(10px)"},e.map(function(e,a){var s="#"+e;return u.default.createElement(n(1471).I13nButton,{key:e,className:"D(ib) Cur(p) Wob(ba) Mb(8px) Mend(8px) Fz(13px) Px(6px) Py(3px) Bgc(#cfe8ff) Bdrs(3px)",i13nModel:(0,n(1471).getI13nModel)("related-tags",Object.assign({slk:s,cpos:a},t)),onClick:this.removeSelectedTag.bind(this,e)},u.default.createElement("span",null,s),u.default.createElement("div",{className:"D(ib) Pos(r) Ta(c) T(2px) Mstart(8px) W(16px) H(16px) Bdc(t) Bdrs(50%) C($c-fuji-grey-g) Bgc($c-fuji-blue-1-a):h"},u.default.createElement(n(31).Icon,{asset:v.default,width:13,height:13,color:"#878c91",className:"Va(bl)! Fill(#fff)!:h Stk(#fff)!:h"})))},this))}}},{key:"getUpdatedRelatedTags",value:function(e,t,n){if(e&&e.size){var a=n?n.split(","):[],s=t&&t.size?t.join(",").split(","):[],o=a.concat(s);return e.filter(function(e){return-1===o.indexOf(e.get("tag"))})}}},{key:"renderTags",value:function(){var e=this.state,t=e.relatedTags,a=e.selectedTags,s=this.context.tagsAnd,o=this.getUpdatedRelatedTags(t,a,s),r=a&&a.size;if(!o||0===o.size)return u.default.createElement("div",{className:"Mt(4px) Fz(11px) C($c-fuji-grey-f) Lh(14px)"},u.default.createElement(n(35).FormattedMessage,{id:r?"CANVASS_RELATED_TAGS_NO_MORE_TAGS_TO_FILTER_MESSAGE":"CANVASS_RELATED_TAGS_CURRENTELY_NO_TAGS_TO_FILTER_MESSAGE"}),u.default.createElement("span",null," "),r?u.default.createElement(n(35).FormattedMessage,{id:"CANVASS_RELATED_TAGS_APPLY_MESSAGE"}):void 0);var i={pos:t&&t.size||0,outcm:"select"};return u.default.createElement("div",{className:"Mt(6px) relatedTags"},o.map(function(e,t){var a="#"+e.get("tag");return u.default.createElement(n(1471).I13nButton,{key:a,className:"D(ib) Wob(ba) Cur(p) Mb(8px) Mend(8px) Fz(13px) Px(6px) Py(3px) Bgc(#cfe8ff) Bdrs(3px) Bgc($c-fuji-blue-1-a):h C(#fff):h",i13nModel:(0,n(1471).getI13nModel)("related-tags",Object.assign({slk:a,cpos:t},i)),onClick:this.handleSelectTag.bind(this,e)},a)},this))}},{key:"renderHeading",value:function(){var e=this.context.tagsAnd;e=e?"#"+e.replace(/,/g,", #"):"";var t=this.state.selectedTags&&this.state.selectedTags.size;return u.default.createElement("div",{className:"Mb(8px) Fz(15px) Fw(b)"},e?e+" +":t?u.default.createElement(n(35).FormattedMessage,{id:"CANVASS_SELECTED_TAGS"}):void 0,!t&&e?u.default.createElement("div",{className:"D(ib) W(65px) Mstart(5px) BdB Bdc(#bfbfc5) Bdbw(1px)"}):void 0)}},{key:"render",value:function(){var e="smartphone"===(0,p.default)(this.context,["session","dimensions","device"]),t=c.default.dedupe("related-tags ignore-react-onclickoutside W(260px) Pos(a) T(45px) Px(20px) Pt(15px) Pb(20px) Bgc(#fff) Z(3) Bd Bdrs(3px) Bdc($c-fuji-grey-c) Bxsh(boxShadowFlag)",{"Start(75px)":!e}),a=!(this.props.selectedTags&&this.props.selectedTags.size||this.state.selectedTags&&this.state.selectedTags.size),s=a?null:this.handleNewSearch,o=c.default.dedupe("Mt(16px) Fz(13px) M(0) Lh(n) H(35px) W(70px)",{"Cur(d)! C($c-fuji-grey-e) Bgc($c-fuji-grey-c) Bgc($c-fuji-grey-c):h":a});return u.default.createElement("div",{className:t},u.default.createElement(n(1471).I13nButton,{className:"related-tags-close-btn Pos(a) End(0) T(0) O(n)",i13nModel:(0,n(1471).getI13nModel)("related-tags",{slk:"cancel"}),onClick:this.props.handleRemoveRelatedTags},u.default.createElement(n(31).Icon,{asset:v.default,width:16,height:16,color:"#b9bdc5",className:"Fill(#000)!:h"})),this.renderHeading(),this.renderSelectedTags(),u.default.createElement("div",{className:"C($c-fuji-grey-l)"},u.default.createElement(n(35).FormattedMessage,{id:"CANVASS_RELATED_TAGS_FILTER_MESSAGE"})),this.renderTags(),u.default.createElement(n(1471).I13nButton,{onClick:s,i13nModel:(0,n(1471).getI13nModel)("related-tags",{slk:"apply"}),className:c.default.get("btn btn-primary",o)},u.default.createElement(n(35).FormattedMessage,{id:"CANVASS_APPLY"})))}}]),t}(n(1).PureComponent);x.contextTypes={componentConfig:l.default.object.isRequired,configStoreState:l.default.object,context:l.default.string,contextDisplayText:l.default.string,contextUrl:l.default.string,executeAction:l.default.func,getStore:l.default.func,i13n:l.default.object,instanceId:l.default.string,session:l.default.object,tags:l.default.string,tagsAnd:l.default.string,tagsOr:l.default.string},t.default=(0,h.default)(x),e.exports=t.default},3309:function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),l=a(n(0)),u=a(n(1)),c=a(n(1597)),d=a(n(2)),f=a(n(93)),p=function(e){function t(e,n){s(this,t);var a=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return(0,c.default)(a,["handleCloseFlyout","handleOpenFlyout","handleToggleFlyout","renderFlyout"]),a.state={flyoutOpened:!1,isDesktop:"desktop"===(0,d.default)(n.session,["dimensions","device"])},a}return r(t,e),i(t,[{key:"handleToggleFlyout",value:function(){this.setState({flyoutOpened:!this.state.flyoutOpened})}},{key:"handleOpenFlyout",value:function(){this.setState({flyoutOpened:!0})}},{key:"handleCloseFlyout",value:function(){this.setState({flyoutOpened:!1})}},{key:"renderFlyout",value:function(e){if(this.state.flyoutOpened){var t=void 0,a=e.POSITIVE,s=e.NEUTRAL,o=e.NEGATIVE;return t=a>=s&&a>=o?u.default.createElement(n(35).FormattedHTMLMessage,{id:"CANVASS_SENTIMENTS_POSITIVE",values:{className:"C($c-fuji-green-1-b)"}}):s>=a&&s>=o?u.default.createElement(n(35).FormattedHTMLMessage,{id:"CANVASS_SENTIMENTS_NEUTRAL",values:{className:"C($c-fuji-orange-b)"}}):u.default.createElement(n(35).FormattedHTMLMessage,{id:"CANVASS_SENTIMENTS_NEGATIVE",values:{className:"C($c-fuji-red-2-a)"}}),u.default.createElement("div",{className:"arrow_box Pos(a) End(0) W(150px) Whs(pl) Ta(c) Fw(500) T(28px) P(12px) Bgc(#fff) Z(3) Bd Bdrs(3px) Bdc($c-fuji-grey-c) Bxsh(boxShadowFlag)"},this.state.isDesktop?null:u.default.createElement(n(1471).I13nButton,{i13nModel:(0,n(1471).getI13nModel)("sentiments-close-tap"),onClick:this.handleCloseFlyout,className:"sentiments-close-btn Pos(a) End(0) P(0) Mend(2px) T(0) O(n)"},u.default.createElement(n(31).Icon,{asset:f.default,width:16,height:16,color:"#b9bdc5"})),t)}}},{key:"renderSentiment",value:function(e,t,n){return u.default.createElement("span",null,u.default.createElement("span",{className:"W(15px) H(15px) D(ib) Va(tt) Bgz(330%) Bg(sentimentsImg) "+n}),u.default.createElement("span",{className:"Pstart(3px) Fz(11px) Fw(b) "+t},e+"%"))}},{key:"componentDidUpdate",value:function(e,t){var a=this.state.flyoutOpened;t.flyoutOpened!==a&&a&&this.state.isDesktop&&(0,n(1471).fireRapidClick)(Object.assign({},this.context.i13n.getI13nNode().getMergedModel(),(0,n(1471).getI13nModel)("sentiments-tap"),{itc:2}))}},{key:"render",value:function(){var e=this.props.sentiments,t=this.state.isDesktop;if(!e||0===e.size)return null;var a={},s=0;return e.forEach(function(e){var t=e.get("count");a[e.get("sentiment")]=t,s+=t}),s<=0?null:(a.POSITIVE=Math.round(a.POSITIVE/s*100)||0,a.NEUTRAL=Math.round(a.NEUTRAL/s*100)||0,a.NEGATIVE=100-a.POSITIVE-a.NEUTRAL,u.default.createElement(n(21).I13nDiv,{bindClickEvent:!t,className:this.props.className,i13nModel:(0,n(1471).getI13nModel)("sentiments-tap"),onClick:t?null:this.handleToggleFlyout,onMouseEnter:this.handleOpenFlyout,onMouseLeave:this.handleCloseFlyout},this.renderFlyout(a),this.renderSentiment(a.POSITIVE,"C($c-fuji-green-1-b) Pend(6px)","Bgp(0)"),this.renderSentiment(a.NEUTRAL,"C($c-fuji-orange-b) Pend(6px)","Bgpx(50%)"),this.renderSentiment(a.NEGATIVE,"C($c-fuji-red-2-a)","Bgpx(100%)")))}}]),t}(n(1).PureComponent);p.contextTypes={i13n:l.default.object,intl:l.default.object,session:l.default.object},t.default=p,e.exports=t.default},3310:function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function i(e){return{tumblrData:e.getStore(g.default).get("data")}}Object.defineProperty(t,"__esModule",{value:!0}),t.TumblrStickers=void 0;var l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},u=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),c=a(n(0)),d=a(n(1)),f=a(n(2043)),p=a(n(309)),m=a(n(3311)),h=a(n(509)),g=a(n(2542)),y=a(n(3312)),v="popular",x=700,b=(0,n(35).defineMessages)({placeholder:{id:"CANVASS_SEARCH_GIF"}}),S=t.TumblrStickers=function(e){function t(e){s(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={isLoading:!0,search:v},n.handleSearch=(0,p.default)(n.handleSearch.bind(n),x),n}return r(t,e),u(t,[{key:"componentWillMount",value:function(){this.context.executeAction(m.default,{})}},{key:"handleSearch",value:function(){var e=this.refs.search&&this.refs.search.value||v;this.setState({isLoading:!0,search:e});var t={search:e},a=this.props.tumblrData.getIn([e,"offset"]);t.offset=a||0,this.context.executeAction(m.default,t),(0,n(1471).fireRapidEvent)("secvw",{slk:"gif-search-"+e,elm:"cmmt_gif",outcm:"show",context:this.context.context,cat:this.context.tags,itc:1,t3:a||!1})}},{key:"componentWillReceiveProps",value:function(e){e.tumblrData&&this.setState({isLoading:!1})}},{key:"render",value:function(){var e=this.state,t=e.isLoading,n=e.search,a=this.props.tumblrData,s=a.getIn([n,"error"]),o=this.context.intl,r=a.getIn([n,"stickers"]),i=a.getIn([n,"authors"]),u=parseInt(a.getIn([n,"offset"]),10);r=r?r.toJS():[];var c=f.default.dedupe("canvass-tumblr-stickers Pos(r) Pb(15px) H(145px) tumblr D(b) W(100%)",{"H(65px)":!this.state.isLoading&&!r.length});return d.default.createElement("div",{className:c},d.default.createElement(y.default,l({},this.props,{authors:i,error:s,handleSearch:this.handleSearch,isLoading:t,offset:u,stickers:r,tumblrData:void 0})),d.default.createElement("input",{"aria-label":o.formatMessage({id:"CANVASS_SEARCH_GIFS"}),autoFocus:!0,className:"D(ib) M(0) Bd(n) H(21px) Bxsh(n) O(n) Fz(16px) canvass-tumblr-stickers-search Pos(r) B(-16px) Start(50px) Z(1)",onInput:this.handleSearch,ref:"search",placeholder:o.formatMessage(b.placeholder),type:"text"}))}}]),t}(n(1).PureComponent);S.contextTypes={context:c.default.string,executeAction:c.default.func.isRequired,intl:c.default.object,tags:c.default.string},t.default=(0,h.default)(S,[g.default],i)},3311:function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function s(e,t,n){var a=e.getStore(o.default).getState(),s=Object.assign({lang:a.lang,region:a.region,oauthConsumerKey:a.oauthConsumerKey,oauthConsumerSecret:a.oauthConsumerSecret},t),l=t.search||i,u=e.getStore(r.default),c=u.get(["data",l]);if(c&&c.get("stickers")&&!t.offset)return e.dispatch("TUMBLR_RELOAD"),n();e.service.read("popular"===l?"canvass.getPopularGifs":"canvass.getGifs",s,function(a,s){!a&&s&&s.gifresult&&0!==s.gifresult.length?e.dispatch("TUMBLR_LOAD_GIFS",{key:l,data:s,offset:t.offset||0}):e.dispatch("TUMBLR_LOAD_GIFS_ERROR",{key:l,error:a,offset:t.offset||0}),n()})}Object.defineProperty(t,"__esModule",{value:!0}),t.default=s;var o=a(n(117)),r=a(n(2542)),i="popular";e.exports=t.default},3312:function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.Stickers=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),l=a(n(0)),u=a(n(1)),c=a(n(1597)),d=a(n(309)),f=(0,n(21).createI13nNode)("div",{bindClickEvent:!0}),p=300,m=t.Stickers=function(e){function t(e){s(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return(0,c.default)(n,["handlePostSticker"]),n.onScroll=(0,d.default)(n.onScroll.bind(n),p),n}return r(t,e),i(t,[{key:"componentDidMount",value:function(){this.paginating=!1}},{key:"componentDidUpdate",value:function(){this.paginating&&this.scrollContainer&&!this.props.isLoading&&setTimeout(function(){this.scrollContainer.scrollLeft+=50,this.paginating=!1}.bind(this),0)}},{key:"handlePostSticker",value:function(e,t){this.props.onStickerClick&&this.props.onStickerClick(e,t)}},{key:"onScroll",value:function(){if((this.scrollContainer=this.refs.sticker)&&this.scrollContainer.getBoundingClientRect){var e=this.scrollContainer.getBoundingClientRect();this.props.offset&&!this.props.error&&e&&this.scrollContainer.scrollLeft+e.width+200>=this.scrollContainer.scrollWidth&&(this.paginating=!0,this.props.handleSearch())}}},{key:"renderErrorBox",value:function(){var e=this.props.stickers;return!this.props.error||e&&e.length?null:u.default.createElement("div",{className:"stickers-error-box H(100%) Bg(#fff) Ta(c) C($c-fuji-grey-g) Pos(a) W(100%) Z(1)"},u.default.createElement("span",{className:"Pos(r) T(45%)"},u.default.createElement(n(35).FormattedMessage,{id:"CANVASS_NO_GIFS_FOUND"})))}},{key:"renderLoadingBox",value:function(){return this.props.isLoading?u.default.createElement("div",{className:"stickers-loading-box H(100%) Bg(bgLoading) Op(0.5) Ta(c) C($c-fuji-grey-g) Pos(a) W(100%) Z(1)"}):null}},{key:"renderStickersList",value:function(){var e=this.props.stickers;if(!e||!e.length)return null;return u.default.createElement("div",{className:"Pos(r) D(b) Bgc(#fff) Maw(100%)!"},u.default.createElement("div",{className:"Row Pos(r)"},u.default.createElement("div",{ref:"sticker",className:"stickers-list H(100%) Ovx(s) Ovy(h) Whs(nw) W(100%) Ovs(touch)",onScroll:this.onScroll},e.map(this.renderItem,this))))}},{key:"renderItem",value:function(e,t){for(var a=this.context,s=this.props,o=s.authors,r=s.overlayClasses,i=s.overlayLabelClasses,l=e[e.length-1],c=e.length-1;c>=0;c--)if(e[c].height>=145){l=e[c];break}var d=l,p=d.url,m=(0,n(1471).getI13nModel)("tumblr-post",{slk:"gif-"+p,context:a.context,cat:a.tags});return u.default.createElement(f,{i13nModel:m,key:p,onClick:this.handlePostSticker.bind(this,e,o.get(t)),className:"D(ib) Pos(r) Mend(4px) sticker-item"},u.default.createElement("img",{className:"Cur(p)",height:145,width:Math.round(145/l.height*l.width),src:p}),u.default.createElement("div",{className:r},u.default.createElement("p",{className:i},u.default.createElement(n(35).FormattedMessage,{id:"CANVASS_POST"}))))}},{key:"render",value:function(){return u.default.createElement("div",{className:"H(100%) Va(t) Pstart(16px) Pos(r) Maw(100%)! stickers"},this.renderLoadingBox()||this.renderErrorBox(),this.renderStickersList())}}]),t}(n(1).PureComponent);m.contextTypes={context:l.default.string,tags:l.default.string},m.defaultProps={overlayClasses:"sticker-overlay W(100%) H(100%) Pos(a) T(0) Start(0) Bg(overlaySticker):h Op(0) Op(1):h Trsdu(.42s) Cur(p)",overlayLabelClasses:"post-label Pos(r) Ta(c) Fw(600) Fz(14px) W(54px) H(20px) T(50%) Start(50%) Translate(-50%,-50%) P(6px) C(#fff) Bgc(#222) Bdrs(2px)",stickers:[]},t.default=m},3313:function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),l=a(n(0)),u=a(n(1)),c=a(n(1597)),d=a(n(2)),f=a(n(5)),p=function(e){function t(e,n){s(this,t);var a=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.state={hover:!1},e.isReadOnly||(0,c.default)(a,["handleSelection"]),a}return r(t,e),i(t,[{key:"onMouseEnter",value:function(){this.setState({hover:!0})}},{key:"onMouseLeave",value:function(){this.setState({hover:!1})}},{key:"componentWillMount",value:function(){var e=this;e.handleMouseEnter=e.onMouseEnter.bind(e),e.handleMouseLeave=e.onMouseLeave.bind(e)}},{key:"handleSelection",value:function(){var e=this,t=e.props;t.isReadOnly||t.handleSelection(t.isSelected?null:t.value)}},{key:"render",value:function(){var e=this,t=this.props,a=t.config,s=(0,f.default)("Fz(12px) Px(8px) Mend(4px) Va(m) Bdrs(3px)",{"C($c-fuji-grey-g) Bgc($c-fuji-grey-b) Cur(d) Py(3px)":t.isReadOnly,"Bdc($c-fuji-grey-c) Pt(4px) Bds(s)":!t.isReadOnly,"Bgc($c-fuji-grey-b) Bdc($c-fuji-grey-c) Bds(s)":e.state.hover&&!t.isSelected,"C(#fff) Bgc($c-fuji-purple-1-a) Bdc($c-fuji-purple-1-a) Bds(s)":t.isSelected}),o=this.props.isSelected?"#fff":t.isReadOnly?"#333":"#000";if(t.isReadOnly)return u.default.createElement("div",{className:s},a.icon?u.default.createElement(n(31).Icon,{name:a.icon.name,className:a.icon.className+" Cur(d)",color:o,height:18,style:a.icon.style,width:18}):void 0,a.title);var r=(0,n(1471).getI13nModel)("userlabels-tap",{slk:t.isSelected?"unselect userlabel "+t.value:"select userlabel "+t.value}),i=this.context,l="desktop"===(0,d.default)(i,["session","dimensions","device"]);return u.default.createElement(n(1471).I13nButton,{className:s,i13nModel:r,onMouseEnter:l?e.handleMouseEnter:null,onMouseLeave:l?e.handleMouseLeave:null,onClick:this.handleSelection,type:"button"},a.icon?u.default.createElement(n(31).Icon,{name:a.icon.name,className:a.icon.className,color:o,height:18,style:a.icon.style,width:18}):void 0,a.title)}}]),t}(n(1).PureComponent);p.contextTypes={session:l.default.object},p.defaultProps={isReadOnly:!0,isSelected:!1},t.default=p,e.exports=t.default},3314:function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),l=a(n(0)),u=a(n(1)),c=a(n(2)),d=a(n(130)),f=a(n(2766)),p=function(e){function t(e){s(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={hover:!1},n}return r(t,e),i(t,[{key:"onMouseEnter",value:function(){this.setState({hover:!0})}},{key:"onMouseLeave",value:function(){this.setState({hover:!1})}},{key:"handleRating",value:function(e){var t=this.context,n=this.props;t.executeAction(f.default,{context:n.contextId,isUserMessageHistory:t.isUserMessageHistory||null,instanceId:t.instanceId,messageId:n.messageId,namespace:n.messageNamespace,voteType:e===n.voteType?"clear":n.voteType,replyId:n.replyId,pos:"number"==typeof t.pos?t.pos:null})}},{key:"bindHandleRating",value:function(e){var t={trailing:!1};this.handleVote=(0,d.default)(this.handleRating.bind(this,e.vote),1500,t)}},{key:"componentWillMount",value:function(){var e=this;"desktop"===(0,c.default)(e.context,["session","dimensions","device"])&&(e.handleMouseEnter=e.onMouseEnter.bind(e),e.handleMouseLeave=e.onMouseLeave.bind(e)),e.bindHandleRating(e.props)}},{key:"componentWillReceiveProps",value:function(e){this.bindHandleRating(e)}},{key:"render",value:function(){var e=this,t=e.props,a=t.vote,s=t.voteType,o=t.thumbName,r=t.size,i=e.context.intl,l=e.handleVote,c=void 0,d=void 0,f=void 0;c=e.state.hover||a===s?t.selectedColor:t.color,f=a===s?t.selectedIcon:t.icon,d=(0,n(1471).getI13nModel)("vote",{rcv_msg_id:t.replyId||t.messageId,slk:a===s?"undo vote "+o:"vote "+o});var p=(t.replyId||t.messageId)+f,m=t.reactionStats[s+"VoteCount"]||0,h=i.formatNumber(m),g=h+" "+i.formatMessage({id:"CANVASS_REACTION_"+o.toUpperCase()});return t.isSignedIn||(l=t.onToggleToolTip),u.default.createElement(n(1471).I13nButton,{"aria-label":g,className:t.className,onClick:l,onMouseEnter:e.handleMouseEnter,onMouseLeave:e.handleMouseLeave,i13nModel:d},u.default.createElement(n(31).Icon,{asset:f,color:c,height:r,key:p,style:{verticalAlign:"middle"},width:r}),m>0?u.default.createElement("span",{className:"D(ib) Mstart(4px) Va(m) Fz(12px) C($c-fuji-grey-g)"},h):void 0)}}]),t}(n(1).PureComponent);p.contextTypes={configStoreState:l.default.object.isRequired,executeAction:l.default.func.isRequired,instanceId:l.default.string,intl:l.default.object,isUserMessageHistory:l.default.bool,pos:l.default.number,session:l.default.object},p.defaultProps={className:"O(n) M(0) P(0) Bd(n)",color:"#878c91",reactionStats:{},selectedColor:"#188fff",size:14,thumbName:"up",voteType:"up"},t.default=p,e.exports=t.default},3315:function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),l=a(n(0)),u=a(n(1)),c=a(n(2314)),d=a(n(1597)),f=a(n(2)),p=a(n(525)),m=a(n(2539)),h=a(n(93)),g=a(n(2541)),y=a(n(2776)),v=a(n(3316)),x=function(e){function t(e){s(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return(0,d.default)(n,["handleKeyDown","handleLoadEvent","handleShowMessages","onScrollHandler"]),n.state={loadingNextComments:!1},n}return r(t,e),i(t,[{key:"getChildContext",value:function(){return{isUserMessageHistory:!0,userMessageHistoryGuid:this.props.userComments.get("guid")}}},{key:"handleClickOutside",value:function(){this.props.handleRemoveUserComments&&this.props.handleRemoveUserComments()}},{key:"handleKeyDown",value:function(e){e&&27===e.keyCode&&(e.preventDefault(),e.stopPropagation(),this.handleClickOutside())}},{key:"handleLoadEvent",value:function(){var e=this.context.i13n.getI13nNode().getMergedModel();e.slk="canvass-load",(0,n(1471).fireRapidEvent)("secvw",e)}},{key:"onScrollHandler",value:function(e){var t=this.scrollingElement,n=t.scrollTop,a=t.scrollHeight,s=t.clientHeight,o=e.deltaY,r=o>0;return r&&o>a-s-n?(t.scrollTop=a,this.cancelScrollEvent(e)):!r&&-o>n?(t.scrollTop=0,this.cancelScrollEvent(e)):void 0}},{key:"cancelScrollEvent",value:function(e){return e.stopImmediatePropagation(),e.preventDefault(),e.returnValue=!1,!1}},{key:"componentDidMount",value:function(){this.context.handleOverlay(!0),this.scrollingElement=(0,n(10).findDOMNode)(this.refs.usercomments),this.scrollingElement.addEventListener("wheel",this.onScrollHandler,!1),this.scrollingElement.focus(),this.handleLoadEvent(),(0,n(1471).fireRapidPageView)("userHistory")}},{key:"componentWillUnmount",value:function(){this.scrollingElement.removeEventListener("wheel",this.onScrollHandler,!1)}},{key:"componentWillReceiveProps",value:function(e){this.setState({loadingNextComments:!1})}},{key:"componentDidUpdate",value:function(e,t){e.userComments.get("guid")!==this.props.userComments.get("guid")&&this.handleLoadEvent()}},{key:"handleShowMessages",value:function(e){var t=this.props.userComments,n={guid:t.get("guid"),image:t.get("image"),name:t.get("name"),sortBy:t.get("sortBy"),instanceId:this.context.instanceId};"showNext"===e&&(this.setState({loadingNextComments:!0}),n.nextIndex=t.get("nextIndex"),n.showNextClicked=!0),this.context.executeAction(m.default,n)}},{key:"renderShowNextButton",value:function(){var e=this;return this.props.userComments.get("showLoadNext")?u.default.createElement(n(1471).I13nButton,{i13nModel:(0,n(1471).getI13nModel)("comments-showMore"),onClick:function(){return e.handleShowMessages("showNext")},className:c.default.get("btn btn-secondary btn-spacing btn-sm-fullwidth","showMore D(b) Mx(a) Pos(r)")},u.default.createElement(n(35).FormattedMessage,{id:this.state.loadingPreviousComments?"CANVASS_LOADING_MORE_COMMENTS":"CANVASS_SHOW_MORE_COMMENTS"})):null}},{key:"render",value:function(){var e=this.context,t=this.props,a=t.isFullScreen,s=t.userComments,o=s.get("messageList"),r=s.get("count"),i=s.get("guid"),l=s.get("image"),d=s.get("name"),p=s.get("sortBy"),m=o&&o.size?o.toJS():[],x=c.default.dedupe("user-comments Pos(a) Ovx(s) Ovs(touch) O(n) Bxz(bb) Start(50%) W(90%) Mstart(-45%) Bgc(#fff) Z(9) Bd Bdrs(5px) Bdc($c-fuji-grey-c) Bxsh(boxShadowFlag) ",{"Pos(f)":a}),b={height:r?n(517).USER_HISTORY_HEIGHT:"auto",top:t.top};return a&&r&&(b.height=Math.min(window.innerHeight-2*n(517).COMMUNITY_BAR_HEIGHT,n(517).USER_HISTORY_HEIGHT)),u.default.createElement(n(21).I13nDiv,{"aria-label":e.intl.formatMessage({id:"CANVASS_SEE_USERS_HISTORY"},{user:d}),className:x,i13nModel:{sec:"cmmt_his"},onKeyDown:this.handleKeyDown,ref:"usercomments",role:"dialog",style:b,tabIndex:"-1"},u.default.createElement(n(1471).I13nButton,{"aria-label":e.intl.formatMessage({id:"CANVASS_CANCEL"}),className:"user-comments-close-btn O(n):a O(n):h Pos(a) Z(1) M(10px) P(0) End(0) T(0)",i13nModel:(0,n(1471).getI13nModel)("user-close-tap"),onClick:t.handleRemoveUserComments},u.default.createElement(n(31).Icon,{asset:h.default,width:30,height:30,color:"#fff",className:"close-icon Cur(p)"})),u.default.createElement(v.default,{className:"user-info",key:"userinfo",creator:i,name:d,imageUrl:l,count:r,isUserMessageHistory:!0}),r>0?u.default.createElement("div",{className:"Px(24px) Pt(12px)"},u.default.createElement(y.default,{arrangement:(0,f.default)(e.componentConfig,["ui","sortTabs","arrangement"]),key:"usercomments-sorting-tabs",count:r,userMessageHistoryName:d,userMessageHistoryImage:l,sortBy:p}),u.default.createElement(g.default,{list:m,sortBy:p,itemClassName:"Py(12px)"}),this.renderShowNextButton()):null)}}]),t}(n(1).PureComponent);x.contextTypes={componentConfig:l.default.object.isRequired,configStoreState:l.default.object,contextDisplayText:l.default.string,contextUrl:l.default.string,executeAction:l.default.func,handleOverlay:l.default.func,i13n:l.default.object,intl:l.default.object,instanceId:l.default.string,session:l.default.object},x.childContextTypes={isUserMessageHistory:l.default.bool,userMessageHistoryGuid:l.default.string},t.default=(0,p.default)(x),e.exports=t.default},3316:function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),l=a(n(0)),u=a(n(1)),c=a(n(1303)),d=function(e){function t(e){return s(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return r(t,e),i(t,[{key:"renderCommentsCount",value:function(){var e=this.props.count,t=this.context.intl,a=void 0;return a=1===e?"1 "+t.formatMessage({id:"CANVASS_COMMENT"}):t.formatNumber(e)+" "+t.formatMessage({id:"CANVASS_COMMENTS"}),u.default.createElement("div",{className:"user-comments-count Pt(10px) Fz(12px) Fw(600) C(#fff)"},u.default.createElement(n(31).Icon,{className:"comment-icon Mend(5px)",color:"#fff",cursorClass:"Cur(d)",height:14,name:"comments",style:{verticalAlign:"middle"},width:14}),a)}},{key:"renderAvatar",value:function(e){var t=this.context,a=this.props,s=a.imageUrl;if(a.creator===t.guid){var o=t.session.dimensions,r="https://login.yahoo.com/account/personalinfo/?.intl="+o.intl+"&.lang="+o.lang;return u.default.createElement(n(1471).I13nAnchor,{className:"avatar W(60px) Fl(start) Mend(20px) Pos(r)",href:r,target:"_blank",title:t.intl.formatMessage({id:"CANVASS_EDIT_PROFILE"})},u.default.createElement(c.default,{src:s,name:e,enableAlphatar:!0,size:60}),u.default.createElement("div",{className:"StretchedBox Bg(gradient) Bdrs(48%) Op(0.7)"}),u.default.createElement(n(31).Icon,{className:"Pos(a) B(6px) Start(20px)",color:"#fff",name:"camera",height:20,width:20}))}return u.default.createElement(c.default,{src:s,name:e,enableAlphatar:!0,size:60,className:"avatar W(60px) Fl(start) Mend(20px)"})}},{key:"getUserProfile",value:function(){var e=this.props.name||this.context.intl.formatMessage({id:"CANVASS_ANONYMOUS"});return u.default.createElement("div",{key:e,className:"user-profile"},this.renderAvatar(e),u.default.createElement("div",{className:"username Pt(4px) Fw(b) Fz(20px) C(#fff)"},e),this.renderCommentsCount())}},{key:"render",value:function(){return u.default.createElement("div",{className:"user-info P(24px) Pb(20px) Pend(36px) Cf Bgc(#1276b9)",style:{backgroundImage:"url(https://s.yimg.com/cv/ae/comments/userbg.png)"}},this.getUserProfile())}}]),t}(n(1).PureComponent);d.contextTypes={guid:l.default.string,intl:l.default.object,session:l.default.object},t.default=d,e.exports=t.default},3317:function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),l=a(n(3318)),u=(a(n(0)),a(n(1))),c=function(e){function t(e){s(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={updating:!1},n}return r(t,e),i(t,[{key:"componentWillReceiveProps",value:function(e){this.setState({updating:this.props.count!==e.count})}},{key:"componentDidUpdate",value:function(){var e=this;e.state.updating&&setTimeout(function(){e.setState({updating:!1})},500)}},{key:"render",value:function(){var e=this.props,t=e.className,a=e.count,s=this.state.updating;return a?u.default.createElement("div",{className:"Fl(end) Fz(14px) Fw(500) Trsdu(.5s) Trsp(color) "+(t||"")+" "+(s?"C($c-fuji-purple-1-a)":"C($c-fuji-grey-g)")},u.default.createElement(n(31).Icon,{asset:l.default,className:"Mend(6px)",color:"#5601ec",height:18,style:{verticalAlign:"text-bottom"},width:18}),u.default.createElement(n(35).FormattedMessage,{id:"CANVASS_USERS_VIEWING",values:{count:a}})):null}}]),t}(n(1).PureComponent);t.default=c,e.exports=t.default},3318:function(e,t){if(void 0===n)var n={};n["groups-fill"]={name:"groups-fill",height:16,width:16,path:"M5 7.667c-1.196 0-2.167-.97-2.167-2.167S3.803 3.333 5 3.333c1.197 0 2.167.97 2.167 2.167S6.197 7.667 5 7.667zM13.167 5.5c0 1.197-.97 2.167-2.167 2.167S8.833 6.697 8.833 5.5 9.803 3.333 11 3.333c1.197 0 2.167.97 2.167 2.167zm1.48 4.38c-.09-.083-.175-.167-.277-.244-.794-.59-2.008-.97-3.37-.97-.343 0-.643.03-.85.058-.086.01-.157.022-.206.03l-.088.016c-.003 0-.005.003-.01.004-.218.037-.44.074-.644.13.12.09.226.187.33.286.504.49.8 1.063.8 1.682v2.13h4.334c.366 0 .667-.302.667-.668V11.27c0-.514-.258-.988-.686-1.39zM8 9.396c-.78-.45-1.833-.73-3-.73-1.362 0-2.575.378-3.37.97-.102.076-.188.16-.275.243-.43.402-.688.876-.688 1.39v1.064c0 .367.3.667.667.667h8v-1.728c0-.514-.258-.988-.686-1.39-.088-.084-.174-.168-.277-.245-.112-.085-.237-.164-.37-.24z"},void 0!==e&&e.exports&&(e.exports=n["groups-fill"])}});